<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/time-series" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.8.0">
<title data-rh="true">Time Series Analysis with Feldera | Feldera Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://docs.feldera.com/tutorials/time-series"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Time Series Analysis with Feldera | Feldera Documentation"><meta data-rh="true" name="description" content="This guide covers concepts required to effectively process time series"><meta data-rh="true" property="og:description" content="This guide covers concepts required to effectively process time series"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.feldera.com/tutorials/time-series"><link data-rh="true" rel="alternate" href="https://docs.feldera.com/tutorials/time-series" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.feldera.com/tutorials/time-series" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://WX24466N8W-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Guides","item":"https://docs.feldera.com/tutorials/"},{"@type":"ListItem","position":2,"name":"Time Series Analysis with Feldera","item":"https://docs.feldera.com/tutorials/time-series"}]}</script><link rel="search" type="application/opensearchdescription+xml" title="Feldera Documentation" href="/opensearch.xml">



<link rel="preconnect" href="https://us.i.posthog.com">
<script>!function(t,e){var o,s,r,a;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,n,p){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(r=t.createElement("script")).type="text/javascript",r.async=!0,r.src=n.api_host.replace(".i.posthog.com","-assets.i.posthog.com")+"/static/array.js",(a=t.getElementsByTagName("script")[0]).parentNode.insertBefore(r,a);var g=e;for(void 0!==p?g=e[p]=[]:p="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==p&&(e+="."+p),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags getFeatureFlag getFeatureFlagPayload reloadFeatureFlags group updateEarlyAccessFeatureEnrollment getEarlyAccessFeatures getActiveMatchingSurveys getSurveys onSessionId".split(" "),s=0;s<o.length;s++)c(g,o[s]);e._i.push([i,n,p])},e.__SV=1)}(document,window.posthog||[]),posthog.init("phc_GKR68l5zo531AD1R3cnE3MCPEBPXTqgYax4q053LVBD",{api_host:"https://us.i.posthog.com",id:"default"})</script>
<script async defer="defer" id="hs-script-loader" src="//js.hs-scripts.com/45801078.js"></script><link rel="stylesheet" href="/assets/css/styles.6b0c5225.css">
<script src="/assets/js/runtime~main.6c308264.js" defer="defer"></script>
<script src="/assets/js/main.1e95da6d.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light";var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a href="https://www.feldera.com" target="_blank" rel="noopener noreferrer" class="navbar__brand"><div class="navbar__logo"><img src="/img/logo-color-dark.svg" alt="Feldera Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo-color-light.svg" alt="Feldera Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/get-started">Get Started</a><a class="navbar__item navbar__link" href="/sql">SQL Reference</a><a class="navbar__item navbar__link" href="/connectors">Connectors</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a href="https://join.slack.com/t/felderacommunity/shared_invite/zt-222bq930h-dgsu5IEzAihHg8nQt~dHzA" target="_blank" rel="noopener noreferrer" class="dropdown__link">Slack<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://discord.com/invite/s6t5n9UzHE" target="_blank" rel="noopener noreferrer" class="dropdown__link">Discord<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li><a href="https://github.com/feldera/feldera" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Command+K)"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/">What is Feldera?</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/architecture/enterprise">Architecture</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/get-started/">Install Feldera</a><button aria-label="Expand sidebar category &#x27;Install Feldera&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/tutorials/">Guides</a><button aria-label="Collapse sidebar category &#x27;Guides&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/tutorials/basics/">Feldera Basics</a><button aria-label="Expand sidebar category &#x27;Feldera Basics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/use_cases/batch/intro">Accelerating Batch Analytics</a><button aria-label="Expand sidebar category &#x27;Accelerating Batch Analytics&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/use_cases/fraud_detection/">Real-time Fraud Detection</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/use_cases/real_time_apps/part1">Real-time Web Applications</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tutorials/time-series">Time Series Analysis with Feldera</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/use_cases/fine_grained_authorization/intro">Fine-Grained Authorization</a><button aria-label="Expand sidebar category &#x27;Fine-Grained Authorization&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/use_cases/otel/intro">OpenTelemetry Analysis</a><button aria-label="Expand sidebar category &#x27;OpenTelemetry Analysis&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/tutorials/rest_api/">Rest API</a><button aria-label="Expand sidebar category &#x27;Rest API&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/monitoring/">Monitoring and Profiling</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/interface/">Feldera Interface</a><button aria-label="Collapse sidebar category &#x27;Feldera Interface&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interface/web-console">Web Console</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/interface/cli">Command line tool (fda)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="/python/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">Python SDK<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="/api" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">REST API<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pipelines/">Pipelines</a><button aria-label="Collapse sidebar category &#x27;Pipelines&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/sql/">Feldera SQL</a><button aria-label="Expand sidebar category &#x27;Feldera SQL&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/connectors/">Connectors</a><button aria-label="Expand sidebar category &#x27;Connectors&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/formats/">Formats</a><button aria-label="Expand sidebar category &#x27;Formats&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pipelines/lifecycle">Reference: Pipeline Lifecycle</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pipelines/configuration">Settings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pipelines/fault-tolerance">Fault tolerance and checkpoint/resume</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pipelines/modifying">Modifying a Pipeline</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pipelines/checkpoint-sync">Synchronizing checkpoints to object store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pipelines/transactions">Efficient Bulk Data Processing using Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pipelines/latency">Measuring Pipeline Latency</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pipelines/sidecar">Sidecar Containers</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/operations/guide">Feldera Operations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/literature/papers">Literature</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/changelog">Changelog</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/tutorials/"><span>Guides</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Time Series Analysis with Feldera</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Time Series Analysis with Feldera</h1></header>
<p>This guide covers concepts required to effectively process <strong>time series</strong>
data with Feldera.  A time series is a sequence of events, such as IoT sensor
readings or financial transactions, where each event is associated with one or
more timestamps.  Time series data is inherently dynamic, changing continuously
as new events arrive in real-time.  Feldera is designed to
compute over changing data, making it well-suited for time series
analytics.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Most examples in this guide are available as a pre-packaged demo &quot;Time Series Analysis with Feldera&quot;
that ships with the
<a href="https://docs.feldera.com/get-started/docker" target="_blank" rel="noopener noreferrer">Feldera Docker container</a> and the
<a href="https://try.feldera.com" target="_blank" rel="noopener noreferrer">online sandbox</a>.</p></div></div>
<p>At a high-level, Feldera allows users to efficiently compute on time series data by
providing <a href="#timestamp-columns-and-lateness"><code>LATENESS</code></a> annotations on tables and views. These
annotations describe the datasource and tell Feldera the maximum out-of-orderness in the data.
For example, it allows users to convey to Feldera a hint of the form &quot;I know that data from my
IoT sensor will never get delayed by more than a day&quot;. Feldera takes these hints and automatically
decides when it is safe to drop state that won&#x27;t affect the output of any of the views. <strong>This allows
Feldera to evaluate various classes of queries on infinite streams of data (like telemetry data)
with finite memory, making it extremely resource efficient.</strong></p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Feldera does not automatically garbage collect <a href="/sql/materialized">materialized tables and views</a>.
If such a table stores an unbounded time series, it will continue to consume storage without limit.
In addition, if the table has a primary key (PK), Feldera will maintain a PK index for this table,
which will only be garbage collected if at least one of the PK columns has a <code>LATENESS</code> annotation.</p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Feldera implements an <code>INSERT</code> or <code>UPDATE</code> in a table with a primary
key as a pair of <code>INSERT</code> and <code>DELETE</code> operations: a new record is
inserted, and the old record with the same primary key (if present) is
deleted.  For tables with <code>LATENESS</code> this may cause surprising
effects: the <code>DELETE</code> needs to delete the previous version of the
record, with the old timestamp; if this timestamp is behind the
<code>LATENESS</code> threshold, the entire INSERT or UPDATE is considered late
and is thus ignored.  This effectivelly means that &quot;old&quot; records in
such a table can never be updated or deleted.</p></div></div>
<p>Users can further take advantage of <code>LATENESS</code> annotations to control
<strong>when</strong> the output of a query is produced by Feldera using
<a href="#emitting-final-values-of-a-view-with-emit_final"><code>emit_final</code></a>
annotations.</p>
<p>In the following sections, we will explain lateness and other key concepts with
which users can efficiently compute over timeseries data.</p>
<p>The last part of this guide lists <a href="#sql-for-time-series-analytics">SQL patterns</a>
frequently used in time series analysis. Feldera supports garbage collection for
most of these patterns, meaning that the can be evaluated efficiently using
bounded memory.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="timestamp-columns-and-lateness">Timestamp columns and lateness<a href="#timestamp-columns-and-lateness" class="hash-link" aria-label="Direct link to Timestamp columns and lateness" title="Direct link to Timestamp columns and lateness">​</a></h2>
<p>A timestamp column is a column in a SQL table or view that indicates a specific
point in time associated with each row.</p>
<ul>
<li>
<p>There can be any number of timestamp columns in a table. For instance, a
table that describes taxi rides can store the time when the ride order was
received, pickup time, dropoff time, and the time when the payment was
processed.</p>
</li>
<li>
<p>Timestamp columns can have any temporal (<code>TIMESTAMP</code>, <code>DATE</code>, <code>TIME</code>) or
numeric type.</p>
</li>
</ul>
<p><strong>A timestamp column can grow monotonically or almost monotonically</strong>. Time
series data often arrives ordered by timestamp, i.e., every event has the same
or larger timestamp than the previous event.  In some cases, events can get
reordered and delayed, but this delay is bounded, e.g., it may not exceed 1
hour.  We refer to this bound as <strong>lateness</strong>.</p>
<p><strong>Lateness</strong> is a constant bound <code>L</code> associated with a timestamp column in a
table or view, such that if the table contains a record with timestamp equal to
<code>TS</code>, then any future records inserted to or removed from the table will have
timestamps greater than or equal to <code>TS - L</code>.  In other words, updates to the
table cannot arrive more than <code>L</code> time units out of order.
A lateness value of zero indicates that updates to the table arrive strictly in
order, with each new update having a timestamp equal to or later than the previous one.</p>
<p>The Feldera query engine uses lateness information to optimize the execution of
queries.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="specifying-lateness-for-tables-and-views">Specifying lateness for tables and views<a href="#specifying-lateness-for-tables-and-views" class="hash-link" aria-label="Direct link to Specifying lateness for tables and views" title="Direct link to Specifying lateness for tables and views">​</a></h3>
<p>To specify lateness for a table column, the column declaration is annotated with
the <code>LATENESS</code> attribute:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> purchase </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   customer_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ts </span><span class="token keyword" style="color:#00009f">TIMESTAMP</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> LATENESS </span><span class="token keyword" style="color:#00009f">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> HOURS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   amount </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The value of the <code>LATENESS</code> attribute is a constant expression that must have a
type that can be subtracted from the column type.  In the above example,
lateness for a column of type <code>TIMESTAMP</code> is specified as an <code>INTERVAL</code> type.
<code>LATENESS</code> for an integer column is specified as an integer constant.</p>
<p><strong>Views can have lateness too</strong>. Lateness is a property of input data; however
it is not always possible to associate a lateness annotation with an input table
column.  For instance, input data can arrive as JSON strings, which must be
<a href="/sql/json/#parse_json">parsed</a> to extract the actual payload fields, including
timestamps.  In such situations, columns with lateness appear in intermediate
views.  To specify lateness for a view, the <code>LATENESS</code> statement must be used.
The statement specifies a view, a column of the view, and an expression for the
lateness value.  The statement may appear before or after the view declaration:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> v </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">col1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">col2 </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> t</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LATENESS v</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">col1 </span><span class="token keyword" style="color:#00009f">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">HOUR</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><code>LATENESS</code> can only be specified for toplevel view columns; i.e., the following
is illegal: <code>LATENESS v.str.col INTERVAL 1 HOUR</code>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="guidelines-for-writing-lateness-annotations">Guidelines for writing lateness annotations<a href="#guidelines-for-writing-lateness-annotations" class="hash-link" aria-label="Direct link to Guidelines for writing lateness annotations" title="Direct link to Guidelines for writing lateness annotations">​</a></h3>
<p>Keep in mind the following guidelines when choosing lateness annotations for
tables and views:</p>
<ul>
<li>
<p><strong>Lateness is NOT time-to-live</strong>.  Lateness should not be confused with
time-to-live annotations used by some stream processing systems.  Declaring
a column with <code>LATENESS</code> 1 hour does not mean that the data will be discarded
after an hour. The compiler decides what data to store and for how long by
analyzing the entire SQL program.  <code>LATENESS</code> annotations simply inform this
analysis.</p>
</li>
<li>
<p><strong>LATENESS does not affect the output of the program</strong>.  Assuming lateness
annotations are accurate, i.e., input records do not arrive more than lateness
time units out of order, the output of the program with lateness annotations
is guaranteed to be identical to outputs of the same program without annotations.</p>
</li>
<li>
<p><strong>LATENESS does NOT delay computation</strong>.  Feldera does not delay computation
until all out-of-order records have been received.  It always computes the
output of the queries given all inputs received so far and incrementally updates
these outputs as new out-of-order inputs arrive.  (See <a href="#delaying-inputs-with-watermark">below</a>
for an experimental feture that allows delaying inputs on demand).</p>
</li>
<li>
<p><strong>Inputs that violate lateness are discarded.</strong>  When a program receives a record
that is more than lateness time units behind the most recent timestamp value
previously observed in the same column, the pipeline will drop such a record.</p>
</li>
</ul>
<p>We recommend choosing conservative <code>LATENESS</code> values, leaving sufficient time for any
delayed inputs to arrive.  In practice, this may require accounting for potential
upstream failures, such as an IoT device losing cloud connectivity.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lateness-example">Lateness example<a href="#lateness-example" class="hash-link" aria-label="Direct link to Lateness example" title="Direct link to Lateness example">​</a></h3>
<p>Consider the <code>purchase</code> table declared above with 1-hour lateness on the <code>ts</code> column
and the following sequence of inserts into this table:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> purchase </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2020-01-01 00:00:00&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> purchase </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2020-01-01 01:00:00&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Late row, but within the lateness bound.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> purchase </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;2020-01-01 00:10:00&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> purchase </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2020-01-01 02:00:00&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">-- Late row that violates lateness.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTO</span><span class="token plain"> purchase </span><span class="token keyword" style="color:#00009f">VALUES</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;2020-01-01 00:20:00&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">65</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The second insertion arrives in order, since its timestamp is
larger than the timestamp of the first insertion.  The third insertion
is out of order, since its timestamp is smaller than the second
insertion.  But it does not violate lateness, since it is
only 50 minutes late, whereas the specified lateness is 1 hour.
The fifth row violates lateness, since it is 100 minutes late with
respect to the fourth row, and will be discarded.</p>
<p>Note that lateness is a soft bound.  A pipeline is guaranteed to
accept any records that arrive within the bound; but can also accept
late records for a short period of time.  The reason for this is that
Feldera ingests input records in chunks and advances the cutoff timestamp,
below which inputs are discarded, after processing the whole chunk.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="how-feldera-garbage-collects-old-state">How Feldera garbage collects old state<a href="#how-feldera-garbage-collects-old-state" class="hash-link" aria-label="Direct link to How Feldera garbage collects old state" title="Direct link to How Feldera garbage collects old state">​</a></h2>
<p>Consider the <code>purchase</code> table from before.  As new purchase records are added
over time, the table will keep growing.  How much of its history do we need to
store?  A conventional database, serving as a system of record, must store every
record added to it, until it is deleted by the user, so that it can answer
queries over this data on-demand.  In contrast, the Feldera query engine
incrementally maintains a set of views defined ahead of time and
only keeps state needed by those views.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_BuS1"><p>Feldera also supports on-demand queries (also known as <strong>ad hoc queries</strong>) for
materialized tables and views.  See <a href="/sql/materialized#inspecting-materialized-tables-and-views">documentation</a> for details.</p></div></div>
<p>Let’s assume the <code>purchase</code> table is used to compute a single view that tracks
the daily maximum purchase amount:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> daily_max </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">MAX</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> max_amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>If the <code>purchase</code> table did not have the <code>LATENESS</code> annotation,
the query engine would assume that records can be inserted and deleted
with arbitrary timestamps, e.g., it would be possible to delete a year-old
record.  Deleting an old record requires re-computing the daily maximum
for the corresponding date.  This in turn requires storing the entire
purchase history permanently.</p>
<p><strong>We can do better with <code>LATENESS</code></strong>.  The <code>LATENESS</code> annotation guarantees
that changes to the table cannot get delayed by more than one hour relative
to each other.  Hence, daily maxima can only change for the current and, possibly,
previous day.  Since we will never need to reevaluate the query for earlier dates,
we do not need to store older data.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="the-data-retention-algorithm">The data retention algorithm<a href="#the-data-retention-algorithm" class="hash-link" aria-label="Direct link to The data retention algorithm" title="Direct link to The data retention algorithm">​</a></h3>
<p>To explain how Feldera discards unused state, we need to introduce a new concept:</p>
<p><strong>Waterline</strong> of a relation with respect to a timestamp column is a timestamp value
<code>W</code>, such that all future additions or deletions in the relation will have timestamps
greater than or equal to <code>W</code>.</p>
<p>Feldera uses the following procedure to identify and discard unused data:</p>
<ol>
<li>
<p><strong>Compute waterlines of all program relations</strong>. Starting from user-supplied
<code>LATENESS</code> annotations, Feldera identifies all tables and views in the program
that produce outputs monotonic in the input timestamp and computes
waterlines for them.</p>
</li>
<li>
<p><strong>Compute state retention bounds</strong>. For each view in the program, the query engine
determines how much state it needs to maintain in order to evaluate the view incrementally.
Some queries, such as simple projections and filters, do not require keeping any state.
Others, such as joins and aggregates, may require storing the state of their input
relations.  In this case, the query engine determines <strong>how long the state
should be retained</strong> based on the semantics of the query and the waterlines
computed at the previous step.</p>
</li>
<li>
<p><strong>Discard old records</strong>. Feldera continuously runs background jobs that garbage
collect old records that fall below retention bounds.</p>
</li>
</ol>
<p><strong>Not all queries support discarding old inputs</strong>. We list the operators for which
Feldera implements garbage collection <a href="#sql-for-time-series-analytics">below</a>.</p>
<p><strong>Relations can have multiple waterlines</strong>. The query engine can derive waterlines
for multiple columns in a table or view. All these waterlines can be utilized for
garbage collection. For example, if the <code>purchase</code> table included an additional
timestamp column that recorded the time when payment was received, and this column
had its own <code>LATENESS</code> attribute, we could create a view computing daily totals
based on this column, and garbage collection would work for this view as well.</p>
<p><strong>Discarding old records is not equivalent to deleting them</strong>. These are
fundamentally different operations.  Deleting a record means that any outputs
derived from it should be updated.  For example, deleting a year-old purchase
requires recomputing the <code>daily_max</code> query for the corresponding date.
In contrast, a discarded record is conceptually still part of the relation;
however it will not participate in computing any future incremental updates
and therefore does not need to be stored.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="emitting-final-values-of-a-view-with-emit_final">Emitting final values of a view with <code>emit_final</code><a href="#emitting-final-values-of-a-view-with-emit_final" class="hash-link" aria-label="Direct link to emitting-final-values-of-a-view-with-emit_final" title="Direct link to emitting-final-values-of-a-view-with-emit_final">​</a></h2>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The <code>emit_final</code> feature is still experimental, and it may be removed
or substantially modified in the future.</p></div></div>
<p>By default, Feldera updates SQL views incrementally whenever new
inputs arrive. Such incremental updates include deleting existing
rows and inserting new rows into the view.  By monitoring these
updates, the user can observe the most up-to-date results of the
computation.  However, some applications only need to observe its
final outputs, i.e., rows that are guaranteed to
never get deleted or updated.</p>
<p>Consider the following query that computes the sum of all purchases
for each day.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> daily_total </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">SUM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Suppose that a new <code>purchase</code> record arrives every second.  In response,
Feldera updates the <code>daily_total</code> value for the current date,
deleting the old value and inserting a new one.  The user may observe
86400 such updates per day.  In some cases this is precisely what the user
wants--to keep track of the latest value of the aggregate with low latency.
But if the application only requires the final value of the aggregate at
the end of the day, handling all the intermediate updates may introduce
unnecessary overheads. Some applications may not be able to handle
intermediate updates at all.  Typical reasons for this are:</p>
<ul>
<li>
<p><strong>The application is unable to process row deletions</strong>. Some
databases and database connectors cannot ingest deletions
efficiently or at all.</p>
</li>
<li>
<p><strong>The application cannot handle a large volume of incremental
updates.</strong>  As we see in this example, the volume of intermediate
updates can be much larger than the final output, potentially
overwhelming the application.</p>
</li>
<li>
<p><strong>The application is only allowed to act on the final
output</strong>. Consider an application that sends an
email, approves a stock trade or performs some other irreversible
action based on the output or the view. Such actions should only
be taken when the output is final. Handling intermediate outputs can
complicate the logic of the application, as the application may
not be able to reliably identify and discard intermediate values.</p>
</li>
</ul>
<p>The <code>emit_final</code> attribute instructs Feldera to only output final rows
of a view, as in the following example:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> daily_total_final</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;emit_final&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;d&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">SUM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> total</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>The <code>emit_final</code> annotation causes the view to emit only the rows that
have a value in the specified column that is before the view&#x27;s current
waterline.  Let us insert some records in the <code>purchase</code> table and
observe how this affects the waterlines and the output of the view
with and without <code>emit_final</code> annotations.</p>
<table><thead><tr><th><code>INSERT INTO purchase</code></th><th>Output without <code>emit_final</code></th><th>Output with <code>emit_final</code></th></tr></thead><tbody><tr><td><code>VALUES(1, &#x27;2020-01-01 01:00:00&#x27;, 10)</code></td><td><code>insert: {&quot;d&quot;:&quot;2020-01-01 00:00:00&quot;,&quot;total&quot;:10}</code></td><td></td></tr><tr><td><code>VALUES(1, &#x27;2020-01-01 02:00:00&#x27;, 10)</code></td><td><code>delete: {&quot;d&quot;:&quot;2020-01-01 00:00:00&quot;,&quot;total&quot;:10}</code></td><td></td></tr><tr><td></td><td><code>insert: {&quot;d&quot;:&quot;2020-01-01 00:00:00&quot;,&quot;total&quot;:20}</code></td><td></td></tr><tr><td><code>VALUES(1, &#x27;2020-01-02 00:00:00&#x27;, 10)</code></td><td><code>insert: {&quot;d&quot;:&quot;2020-01-02 00:00:00&quot;,&quot;total&quot;:10}</code></td><td></td></tr><tr><td><code>VALUES(1, &#x27;2020-01-02 01:00:00&#x27;, 10)</code></td><td><code>delete: {&quot;d&quot;:&quot;2020-01-02 00:00:00&quot;,&quot;total&quot;:10}</code></td><td><code>insert: {&quot;d&quot;:&quot;2020-01-01 00:00:00&quot;,&quot;total&quot;:20}</code></td></tr><tr><td></td><td><code>insert: {&quot;d&quot;:&quot;2020-01-02 00:00:00&quot;,&quot;total&quot;:20}</code></td><td></td></tr></tbody></table>
<ul>
<li>
<p>Without <code>emit_final</code>, every input update produces an output update,
deleting any outdated records and inserting new records instead.</p>
</li>
<li>
<p>With <code>emit_final</code> only outputs below the current waterline are
produced. In this example, the waterline of the <code>daily_total.d</code>
timestamp column remains at <code>2020-01-01 00:00:00</code> until the last
input, which adds a record with timestamp <code>2020-01-02 01:00:00</code>.
Since <code>purchase.ts</code> has <code>LATENESS</code> of 1 hour, no new updates for
the previous date can be received after this.  The waterline
moves forward by one day and the final value for <code>2020-01-01</code> is output.</p>
</li>
</ul>
<p>The <code>emit_final</code> property must specify either a column name that
exists in the view, or a column number, where 0 is the leftmost view
column.</p>
<p>Note that using <code>emit_final</code> can significantly delay the output of a view.
In the example above, the aggregation is performed over a 1-day window,
resulting in a 1-day delay before the output is produced. If the aggregation
window were extended to 1 year, the view would not produce any outputs for
an entire year.</p>
<p>The use of <code>emit_final</code> is subject to the following restrictions:</p>
<ul>
<li>
<p>If the query engine cannot infer a waterline for the specified
column of the view, it will emit an error at compilation time.</p>
</li>
<li>
<p>Currently this annotation is only allowed on views that are not
<a href="/sql/grammar/#creating-views"><code>LOCAL</code></a>.  It takes effect only
for the view used as output.  If the view is used in defining
other views, these derived views will receive the non-delayed data.</p>
</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="delaying-inputs-with-watermark">Delaying inputs with <code>WATERMARK</code><a href="#delaying-inputs-with-watermark" class="hash-link" aria-label="Direct link to delaying-inputs-with-watermark" title="Direct link to delaying-inputs-with-watermark">​</a></h2>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The <code>WATERMARK</code> feature is still experimental, and it may be removed
or substantially modified in the future.</p></div></div>
<p>Feldera can process data received either in-order or out-of-order.  In both
scenarios, it continuously maintains query results computed based on the inputs
received so far, updating these results as new data arrives.  However, some
applications may not be able to handle results derived from out-of-order data
correctly and prefer to wait until all out-of-order events have been delivered.</p>
<p><code>WATERMARK</code> is an annotation on a column of a table that delays the processing
of the input rows by a specified amount of time.  More precisely, given a <code>WATERMARK</code>
annotation with value <code>WM</code>, an input row with a value <code>X</code> for the watermarked column
will be &quot;held up&quot; until another row with a timestamp <code>&gt;=X + WM</code> is received, at which
point the program will behave as if the row with value <code>X</code> has only just been received.</p>
<p>This delay allows <code>WM</code> time units for out-of-order data to arrive.
For a column with a <code>LATENESS</code> annotation, setting <code>WATERMARK</code> to be equal
to <code>LATENESS</code> ensures that all received data is processed in-order.</p>
<p><code>WATERMARK</code> is specified as an expression that evaluates to a constant value.
The expression must have a type that can be subtracted from the column
type.  For example, a column of type <code>TIMESTAMP</code> may have a watermark
specified as an <code>INTERVAL</code> type:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> purchase_watermark </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   customer_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ts </span><span class="token keyword" style="color:#00009f">TIMESTAMP</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> WATERMARK </span><span class="token keyword" style="color:#00009f">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> HOURS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   amount </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>The current version of the SQL compiler does not support multiple
<code>WATERMARK</code> columns in a single table.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="append-only-tables">Append-only tables<a href="#append-only-tables" class="hash-link" aria-label="Direct link to Append-only tables" title="Direct link to Append-only tables">​</a></h2>
<p>Time series tables are often append-only: once an event has been received, it
cannot be modified or deleted.  Feldera is able to leverage this property to
optimize certain types of queries. Consider the <code>daily_max</code> view from above:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> daily_max </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">MAX</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> max_amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Maintaining the <code>MAX</code> aggregate incrementally requires permanently storing the
entire contents of the <code>purchase</code> table (ignoring the <code>LATENESS</code> annotation on
<code>purchase.ts</code>).  However, if the table is append-only, then the <code>MAX</code> aggregate
can only increase monotonically as new records are added to the table, and we
only need to store the current largest value for each 1-day window.</p>
<p>The <code>append_only</code> annotation on a table instructs Feldera that the table will
only receive <code>INSERT</code> updates, enabling this and other optimizations:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> purchase </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   customer_id </span><span class="token keyword" style="color:#00009f">INT</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   ts </span><span class="token keyword" style="color:#00009f">TIMESTAMP</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">NULL</span><span class="token plain"> LATENESS </span><span class="token keyword" style="color:#00009f">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> HOURS</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   amount </span><span class="token keyword" style="color:#00009f">BIGINT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;append_only&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;true&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Note that <code>append_only</code> annotations are only supported for tables; however
the Feldera query engine automatically derives it for views that depend on
append-only tables.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="sql-for-time-series-analytics">SQL for time series analytics<a href="#sql-for-time-series-analytics" class="hash-link" aria-label="Direct link to SQL for time series analytics" title="Direct link to SQL for time series analytics">​</a></h2>
<p>In this section, we present a catalog of SQL operators and patterns frequently used in
time series analysis. Although these operators are applicable to both time-series and
non-time-series data, they are particularly beneficial when working with time series.</p>
<p>Feldera offers efficient incremental implementations of these constructs and
supports garbage collection for most of them, meaning that they can be evaluated
efficiently in both time and space.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="aggregating-time-series-data-over-fixed-size-time-intervals">Aggregating Time Series Data Over Fixed-Size Time Intervals<a href="#aggregating-time-series-data-over-fixed-size-time-intervals" class="hash-link" aria-label="Direct link to Aggregating Time Series Data Over Fixed-Size Time Intervals" title="Direct link to Aggregating Time Series Data Over Fixed-Size Time Intervals">​</a></h3>
<p>A common practice in time series analysis is to segment the timeline into fixed-size
intervals—such as minutes, hours, days, or years—and aggregate the data within each
segment. Earlier, we encountered two examples of such queries: <code>daily_max</code> and
<code>daily_sum</code>, which apply the <code>MAX</code> and <code>SUM</code> aggregation functions over 1-day
intervals.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="garbage-collection">Garbage collection<a href="#garbage-collection" class="hash-link" aria-label="Direct link to Garbage collection" title="Direct link to Garbage collection">​</a></h4>
<p>The incremental implementation of aggregation operators stores both
the input and output of the operator.  Feldera applies various optimizations to
optimize storage, for example linear aggregation functions, such as
<code>SUM</code>, <code>COUNT</code>, <code>AVG</code>, <code>STDDEV</code>, do not require storing the input relation;
<code>MIN</code> and <code>MAX</code> aggregates over <a href="#append-only-tables">append-only</a> collections
only store one value per group, etc.  On top of these optimizations, the GC
mechanism can discard old records under the following conditions:</p>
<ul>
<li>
<p>Old input records get discarded if at least one of the expressions in the
<code>GROUP BY</code> clause is a monotonic function of a timestamp column, for which the query
engine can establish a waterline.  For instance, in the <code>daily_max</code> view,
<code>TIMESTAMP_TRUNC</code> is a monotonic function over the <code>purchase.ts</code> column.</p>
</li>
<li>
<p>Old output records get discarded if at least one of the output columns
has a waterline.  In the <code>daily_max</code> view, the <code>TIMESTAMP_TRUNC(ts, DAY) as d</code>
column has a waterline.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="tumbling-and-hopping-windows">Tumbling and hopping windows<a href="#tumbling-and-hopping-windows" class="hash-link" aria-label="Direct link to Tumbling and hopping windows" title="Direct link to Tumbling and hopping windows">​</a></h3>
<p><a href="/sql/table/#tumble">Tumbling</a> and <a href="/sql/table/#tumble">hopping</a> window operators
provide a more idiomatic way to slice the timeline into non-overlapping or
overlapping windows.  These operators do not maintain any state and therefore do
not require GC.  The <code>daily_max</code> view can be expressed using the <code>TUMBLE</code> operator
as follows:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> daily_max_tumbling </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    window_start</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">MAX</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TUMBLE</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;DATA&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">TABLE</span><span class="token plain"> purchase</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;TIMECOL&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> DESCRIPTOR</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;SIZE&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    window_start</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="rolling-aggregates">Rolling aggregates<a href="#rolling-aggregates" class="hash-link" aria-label="Direct link to Rolling aggregates" title="Direct link to Rolling aggregates">​</a></h3>
<p><a href="https://www.feldera.com/blog/rolling-aggregates" target="_blank" rel="noopener noreferrer">Rolling aggregates</a> offer a
different way to define time windows. For each data point in a time series, they
compute an aggregate over a fixed time frame (such as a day, an hour, or a
month) preceding this data point.  Rolling aggregates can be expressed in SQL using
<a href="/sql/aggregates#window-aggregate-functions">window aggregate functions</a>.
Here is a version of <code>daily_max</code> that computes <code>MAX</code> over the 1-day window
preceding each event:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> daily_max_rolling </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    amount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">MAX</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">OVER</span><span class="token plain"> window_1_day</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> purchase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WINDOW window_1_day </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> ts RANGE </span><span class="token operator" style="color:#393A34">BETWEEN</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">PRECEDING</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">CURRENT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">ROW</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>Rolling aggregates provide an accurate summary of recent event history for each data
point in the dataset. They are more expensive than
<a href="#tumbling-and-hopping-windows">tumbling and hopping windows</a>, since they instantiate as many
individual windows as there are data points in the table.
Feldera features an efficient incremental implementation of the rolling aggregate operator,
that is capable of evaluating millions of individual windows per second on
a laptop.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="garbage-collection-1">Garbage collection<a href="#garbage-collection-1" class="hash-link" aria-label="Direct link to Garbage collection" title="Direct link to Garbage collection">​</a></h4>
<p>GC for rolling aggregates works similar to regular aggregates (see <a href="#aggregating-time-series-data-over-fixed-size-time-intervals">above</a>):</p>
<ul>
<li>
<p>Old input records are discarded if the <code>ORDER BY</code> expression is a monotonic function
of a timestamp column, for which the query engine can establish a waterline.  For
instance, in the <code>rolling_daily_max</code> view above, the <code>purchase.ts</code> column, used in the
<code>ORDER BY</code> clause, has a waterline.</p>
</li>
<li>
<p>Old output records get discarded if at least one of the output columns
has a waterline.  In the <code>rolling_daily_max</code> view, the <code>ts</code> column copied
from the input table has a waterline.</p>
</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="join-over-timestamp-columns">Join over timestamp columns<a href="#join-over-timestamp-columns" class="hash-link" aria-label="Direct link to Join over timestamp columns" title="Direct link to Join over timestamp columns">​</a></h3>
<p>The following query computes daily totals over the <code>purchase</code> and <code>returns</code>
tables and joins the results by date in order to construct a daily summary
combining both totals for each given day in a single view:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> daily_totals </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase_totals </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> purchase_date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">SUM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> total_purchase_amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> purchase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return_totals </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">returns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> return_date</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token function" style="color:#d73a49">SUM</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">returns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> total_return_amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">returns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">GROUP</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            TIMESTAMP_TRUNC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">returns</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">DAY</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase_totals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">purchase_date </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> d</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase_totals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">total_purchase_amount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return_totals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">total_return_amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase_totals</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">FULL</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">OUTER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return_totals</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase_totals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">purchase_date </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> return_totals</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">return_date</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="garbage-collection-2">Garbage collection<a href="#garbage-collection-2" class="hash-link" aria-label="Direct link to Garbage collection" title="Direct link to Garbage collection">​</a></h4>
<p>The join operator stores both of its input relations.  If at least one pair of
columns being joined on has waterlines (in this case, both <code>purchase_totals.purchase_date</code>
and <code>return_totals.return_date</code> have waterlines), the operator discards old records
below the smaller of the two waterlines.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="as-of-joins">As-of joins<a href="#as-of-joins" class="hash-link" aria-label="Direct link to As-of joins" title="Direct link to As-of joins">​</a></h3>
<p>The <a href="https://www.feldera.com/blog/asof-join" target="_blank" rel="noopener noreferrer"><code>ASOF JOIN</code></a> operator is a specialized
type of JOIN used between two relations with comparable timestamp columns. It is
used to answer questions such as &quot;What was the stock price at
the exact moment of the transaction?&quot; or &quot;What was the account balance just before
the money transfer?&quot;</p>
<p>For each row in the left input relation, the as-of join operator identifies at most
one row in the right input with the closest timestamp that is no greater than the
timestamp in the left row. The example below demonstrates how an as-of join can be
used to extract the customer’s address at the time of purchase from the <code>customer</code>
table.</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> purchase_with_address </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">customer_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    customer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> purchase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">LEFT</span><span class="token plain"> ASOF </span><span class="token keyword" style="color:#00009f">JOIN</span><span class="token plain"> customer MATCH_CONDITION</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> customer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ON</span><span class="token plain"> purchase</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">customer_id </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> customer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">customer_id</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="garbage-collection-3">Garbage collection<a href="#garbage-collection-3" class="hash-link" aria-label="Direct link to Garbage collection" title="Direct link to Garbage collection">​</a></h4>
<p>The incremental as-of join operator stores both of its input relations.  If both
timestamp columns in the <code>MATCH_CONDITION</code> have waterlines, the operator will</p>
<ul>
<li>discard records below the smaller of the two waterlines from the left collection</li>
<li>discard all except the last record below the smaller of the two waterlines for each join key
from the right collection.</li>
</ul>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="lag-and-lead"><code>LAG</code> and <code>LEAD</code><a href="#lag-and-lead" class="hash-link" aria-label="Direct link to lag-and-lead" title="Direct link to lag-and-lead">​</a></h3>
<p><a href="/sql/aggregates#window-aggregate-functions"><code>LAG</code> and <code>LEAD</code></a> SQL window functions allow access
to a previous or following row in a relation.  When used with a window ordered by a timestamp
column, they refer to earlier or later data points in a time series. The following view computes
previous and next purchase amounts for each record in the <code>purchase</code> table:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> purchase_with_prev_next </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ts</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    customer_id</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    amount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LAG</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">OVER</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> customer_id </span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> ts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> previous_amount</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    LEAD</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">OVER</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">PARTITION</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> customer_id </span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain"> ts</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">as</span><span class="token plain"> next_amount</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    purchase</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="garbage-collection-4">Garbage collection<a href="#garbage-collection-4" class="hash-link" aria-label="Direct link to Garbage collection" title="Direct link to Garbage collection">​</a></h4>
<p>GC for <code>LAG</code> and <code>LEAD</code> functions has not been implemented yet (see our
GC feature <a href="https://github.com/feldera/feldera/issues/1850" target="_blank" rel="noopener noreferrer">roadmap</a>).
<a href="https://github.com/feldera/feldera/issues/new/" target="_blank" rel="noopener noreferrer">Let us know</a> if you are interested in this feature.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="now-and-temporal-filters"><code>NOW()</code> and temporal filters<a href="#now-and-temporal-filters" class="hash-link" aria-label="Direct link to now-and-temporal-filters" title="Direct link to now-and-temporal-filters">​</a></h2>
<p>All features discussed so far evaluate SQL queries over time series data without
referring to the current physical time.  Feldera allows using the current
physical time in queries via the <a href="/sql/datetime/#now"><code>NOW()</code></a> function.  The primary use of this
function is in implementing <strong>temporal filters</strong>, i.e., queries that filter
records based on the current time values, e.g.:</p>
<div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">CREATE</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">VIEW</span><span class="token plain"> recent_purchases </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> purchase</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ts </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">NOW</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">INTERVAL</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> DAYS</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p><code>NOW()</code> is the only construct in Feldera that can cause the pipeline to produce
outputs without receiving any new input.  In the above example, the pipeline will
output deletions for records that fall outside the 7-day window as the physical
clock ticks forward.</p>
<p>See <a href="/sql/datetime/#now"><code>NOW()</code></a> documentation for more details.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="garbage-collection-5">Garbage collection<a href="#garbage-collection-5" class="hash-link" aria-label="Direct link to Garbage collection" title="Direct link to Garbage collection">​</a></h4>
<p>Feldera implements garbage collection for temporal filters by discarding records older
than the left window bound (e.g., records more than 7 days old in the above example).
This optimization is sound because <code>NOW()</code> grows monotonically, and does <em>not</em> require
the timestamp column to have a waterline.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-reading">Further reading<a href="#further-reading" class="hash-link" aria-label="Direct link to Further reading" title="Direct link to Further reading">​</a></h2>
<ul>
<li><a href="https://www.feldera.com/blog/lateness-in-streaming-programs" target="_blank" rel="noopener noreferrer">Blog post: LATENESS in streaming programs</a></li>
</ul></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/use_cases/real_time_apps/part3"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">A browser based UI</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/use_cases/fine_grained_authorization/intro"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Use Case: Fine-Grained Authorization</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#timestamp-columns-and-lateness" class="table-of-contents__link toc-highlight">Timestamp columns and lateness</a><ul><li><a href="#specifying-lateness-for-tables-and-views" class="table-of-contents__link toc-highlight">Specifying lateness for tables and views</a></li><li><a href="#guidelines-for-writing-lateness-annotations" class="table-of-contents__link toc-highlight">Guidelines for writing lateness annotations</a></li><li><a href="#lateness-example" class="table-of-contents__link toc-highlight">Lateness example</a></li></ul></li><li><a href="#how-feldera-garbage-collects-old-state" class="table-of-contents__link toc-highlight">How Feldera garbage collects old state</a><ul><li><a href="#the-data-retention-algorithm" class="table-of-contents__link toc-highlight">The data retention algorithm</a></li></ul></li><li><a href="#emitting-final-values-of-a-view-with-emit_final" class="table-of-contents__link toc-highlight">Emitting final values of a view with <code>emit_final</code></a></li><li><a href="#delaying-inputs-with-watermark" class="table-of-contents__link toc-highlight">Delaying inputs with <code>WATERMARK</code></a></li><li><a href="#append-only-tables" class="table-of-contents__link toc-highlight">Append-only tables</a></li><li><a href="#sql-for-time-series-analytics" class="table-of-contents__link toc-highlight">SQL for time series analytics</a><ul><li><a href="#aggregating-time-series-data-over-fixed-size-time-intervals" class="table-of-contents__link toc-highlight">Aggregating Time Series Data Over Fixed-Size Time Intervals</a></li><li><a href="#tumbling-and-hopping-windows" class="table-of-contents__link toc-highlight">Tumbling and hopping windows</a></li><li><a href="#rolling-aggregates" class="table-of-contents__link toc-highlight">Rolling aggregates</a></li><li><a href="#join-over-timestamp-columns" class="table-of-contents__link toc-highlight">Join over timestamp columns</a></li><li><a href="#as-of-joins" class="table-of-contents__link toc-highlight">As-of joins</a></li><li><a href="#lag-and-lead" class="table-of-contents__link toc-highlight"><code>LAG</code> and <code>LEAD</code></a></li></ul></li><li><a href="#now-and-temporal-filters" class="table-of-contents__link toc-highlight"><code>NOW()</code> and temporal filters</a></li><li><a href="#further-reading" class="table-of-contents__link toc-highlight">Further reading</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/get-started">Get Started</a></li><li class="footer__item"><a class="footer__link-item" href="/tutorials/basics/part1">Tutorial</a></li><li class="footer__item"><a class="footer__link-item" href="/sql/intro">SQL Reference</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://join.slack.com/t/felderacommunity/shared_invite/zt-222bq930h-dgsu5IEzAihHg8nQt~dHzA" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discord.com/invite/s6t5n9UzHE" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://bsky.app/profile/feldera.bsky.social" target="_blank" rel="noopener noreferrer" class="footer__link-item">Bluesky<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/feldera/feldera" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Feldera Inc.</div></div></div></footer></div>
</body>
</html>