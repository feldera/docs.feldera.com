"use strict";(self.webpackChunkfeldera_docs=self.webpackChunkfeldera_docs||[]).push([[2718],{28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>t});var r=s(96540);const a={},i=r.createContext(a);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),r.createElement(i.Provider,{value:n},e.children)}},52595:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"get-started/enterprise/kubernetes-guides/eks/ingress","title":"EKS ingress","description":"To allow external access to Feldera and other services running inside the EKS","source":"@site/docs/get-started/enterprise/kubernetes-guides/eks/ingress.md","sourceDirName":"get-started/enterprise/kubernetes-guides/eks","slug":"/get-started/enterprise/kubernetes-guides/eks/ingress","permalink":"/get-started/enterprise/kubernetes-guides/eks/ingress","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"EKS cluster","permalink":"/get-started/enterprise/kubernetes-guides/eks/cluster"},"next":{"title":"Authentication and Authorization","permalink":"/get-started/enterprise/authentication/"}}');var a=s(74848),i=s(28453);const l={},t="EKS ingress",o={},c=[{value:"Ingress installation",id:"ingress-installation",level:2},{value:"1. Ingress controller configuration file",id:"1-ingress-controller-configuration-file",level:3},{value:"2. Ingress controller installation",id:"2-ingress-controller-installation",level:3},{value:"3. Feldera ingress configuration file",id:"3-feldera-ingress-configuration-file",level:3},{value:"4. Feldera ingress installation",id:"4-feldera-ingress-installation",level:3},{value:"5. Usage: accessing the Web Console and API",id:"5-usage-accessing-the-web-console-and-api",level:3},{value:"Inside the VPC",id:"inside-the-vpc",level:4},{value:"Via kubectl port-forwarding",id:"via-kubectl-port-forwarding",level:4},{value:"Additional resources",id:"additional-resources",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"eks-ingress",children:"EKS ingress"})}),"\n",(0,a.jsx)(n.p,{children:"To allow external access to Feldera and other services running inside the EKS\ncluster, we recommend setting up a Kubernetes Ingress controller. This is\nuseful to allow access to the Feldera Web Console or to issue REST API calls\ndirectly."}),"\n",(0,a.jsx)(n.admonition,{type:"tip",children:(0,a.jsx)(n.p,{children:"When you install an ingress controller, it uses an AWS load balancer to expose\nan IP address via a generated DNS name for external access. By default,\ncreating ingress controllers leads to both an internal and external load\nbalancer being created, with the external one being preferred to expose\nservices. Most Feldera Enterprise users should need to expose Feldera services only\nover an internal load balancer."})}),"\n",(0,a.jsx)(n.h2,{id:"ingress-installation",children:"Ingress installation"}),"\n",(0,a.jsx)(n.h3,{id:"1-ingress-controller-configuration-file",children:"1. Ingress controller configuration file"}),"\n",(0,a.jsxs)(n.p,{children:["To install an ingress controller where the external load balancer is disabled,\ncreate a configuration values file named ",(0,a.jsx)(n.code,{children:"ingress-nginx.yaml"})," with the following content:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Filename: ingress-nginx.yaml\ncontroller:\n  ingressClassByName: true\n\n  ingressClassResource:\n    name: nginx\n    enabled: true\n    default: false  # To choose this controller, an Ingress must explicitly add in its spec: ingressClassName: nginx\n    controllerValue: "k8s.io/ingress-nginx-internal"\n\n  service:\n    external:\n      enabled: false\n\n    internal:\n      enabled: true\n      annotations:\n        service.beta.kubernetes.io/aws-load-balancer-internal: "true"\n        service.beta.kubernetes.io/aws-load-balancer-backend-protocol: tcp\n        service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: \'true\'\n        service.beta.kubernetes.io/aws-load-balancer-type: nlb\n'})}),"\n",(0,a.jsx)(n.h3,{id:"2-ingress-controller-installation",children:"2. Ingress controller installation"}),"\n",(0,a.jsxs)(n.p,{children:["Install the nginx Ingress controller with ",(0,a.jsx)(n.code,{children:"helm"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"helm upgrade --install --wait --timeout 2m0s ingress-nginx-internal ingress-nginx \\\n    --repo https://kubernetes.github.io/ingress-nginx \\\n    --namespace ingress-nginx-internal --create-namespace \\\n    -f ingress-nginx.yaml\n"})}),"\n",(0,a.jsx)(n.p,{children:"... you can check the status afterward by running:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n ingress-nginx-internal\nkubectl get services -n ingress-nginx-internal\n"})}),"\n",(0,a.jsx)(n.h3,{id:"3-feldera-ingress-configuration-file",children:"3. Feldera ingress configuration file"}),"\n",(0,a.jsxs)(n.p,{children:["Create a configuration file named ",(0,a.jsx)(n.code,{children:"ingress.yaml"})," with the following content:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'# Filename: ingress.yaml\napiVersion: networking.k8s.io/v1\nkind: Ingress\nmetadata:\n  name: feldera-ingress\nspec:\n  ingressClassName: "nginx"\n  rules:\n  - http:\n      paths:\n      - pathType: Prefix\n        path: /\n        backend:\n          service:\n            name: feldera-api-server\n            port:\n              number: 8080\n'})}),"\n",(0,a.jsx)(n.h3,{id:"4-feldera-ingress-installation",children:"4. Feldera ingress installation"}),"\n",(0,a.jsxs)(n.p,{children:["Use ",(0,a.jsx)(n.code,{children:"kubectl"})," to install the ingress with the values configuration file:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl apply -n feldera -f ingress.yaml\n"})}),"\n",(0,a.jsx)(n.p,{children:"... you can check the status afterward by running:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl get ingress -n feldera\n"})}),"\n",(0,a.jsx)(n.h3,{id:"5-usage-accessing-the-web-console-and-api",children:"5. Usage: accessing the Web Console and API"}),"\n",(0,a.jsx)(n.h4,{id:"inside-the-vpc",children:"Inside the VPC"}),"\n",(0,a.jsx)(n.p,{children:"If you set up the recommended internal-only load balancer, you can now access the web console\nfrom inside your VPC over the load balancer's endpoint, which can be found with:"}),"\n",(0,a.jsx)(n.p,{children:"Find the endpoint of the internal load balancer inside your VPC:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'kubectl get svc -n ingress-nginx-internal ingress-nginx-internal-controller-internal \\\n    -o jsonpath="{.status.loadBalancer.ingress[*].hostname}"\n'})}),"\n",(0,a.jsx)(n.p,{children:"This should return a hostname like:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"abcd-efgh.elb.us-west-1.amazonaws.com\n"})}),"\n",(0,a.jsx)(n.p,{children:"From within your VPC (e.g., via VPN) visit the load balancer endpoint hostname in a browser\nto see the Feldera Web Console."}),"\n",(0,a.jsx)(n.h4,{id:"via-kubectl-port-forwarding",children:"Via kubectl port-forwarding"}),"\n",(0,a.jsxs)(n.p,{children:["If you are not located in the VPC but do have ",(0,a.jsx)(n.code,{children:"kubectl"})," access,\nyou can also reach the load balancer endpoint via kubectl port-forwarding:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl port-forward -n ingress-nginx-internal service/ingress-nginx-internal-controller-internal 8080:80\n"})}),"\n",(0,a.jsxs)(n.p,{children:["While keeping it running in a terminal, visit ",(0,a.jsx)(n.a,{href:"http://127.0.0.1:8080",children:"http://127.0.0.1:8080"}),"\nin a browser to see the Feldera Web Console."]}),"\n",(0,a.jsx)(n.h2,{id:"additional-resources",children:"Additional resources"}),"\n",(0,a.jsx)(n.p,{children:"Documentation regarding AWS-specific load balancer annotations:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://github.com/kubernetes/ingress-nginx/blob/main/deploy/static/provider/aws/deploy.yaml",children:"https://github.com/kubernetes/ingress-nginx/blob/main/deploy/static/provider/aws/deploy.yaml"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.7/guide/service/annotations/",children:"https://kubernetes-sigs.github.io/aws-load-balancer-controller/v2.7/guide/service/annotations/"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html",children:"https://docs.aws.amazon.com/eks/latest/userguide/aws-load-balancer-controller.html"})}),"\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.a,{href:"https://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/how-elastic-load-balancing-works.html",children:"https://docs.aws.amazon.com/elasticloadbalancing/latest/userguide/how-elastic-load-balancing-works.html"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);