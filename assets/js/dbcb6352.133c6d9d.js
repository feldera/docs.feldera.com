"use strict";(self.webpackChunkfeldera_docs=self.webpackChunkfeldera_docs||[]).push([[7862],{28453:(e,s,n)=>{n.d(s,{R:()=>c,x:()=>l});var t=n(96540);const i={},r=t.createContext(i);function c(e){const s=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function l(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),t.createElement(r.Provider,{value:s},e.children)}},75331:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>o});const t=JSON.parse('{"id":"get-started/enterprise/kubernetes-guides/eks/cluster","title":"EKS cluster","description":"Feldera Enterprise can be installed on Amazon\'s Elastic Kubernetes Service (EKS).","source":"@site/docs/get-started/enterprise/kubernetes-guides/eks/cluster.md","sourceDirName":"get-started/enterprise/kubernetes-guides/eks","slug":"/get-started/enterprise/kubernetes-guides/eks/cluster","permalink":"/get-started/enterprise/kubernetes-guides/eks/cluster","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"EKS","permalink":"/get-started/enterprise/kubernetes-guides/eks/"},"next":{"title":"EKS ingress","permalink":"/get-started/enterprise/kubernetes-guides/eks/ingress"}}');var i=n(74848),r=n(28453);const c={},l="EKS cluster",a={},o=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"EKS cluster creation",id:"eks-cluster-creation",level:2},{value:"1. AWS access",id:"1-aws-access",level:3},{value:"2. Cluster configuration",id:"2-cluster-configuration",level:3},{value:"3. Cluster creation",id:"3-cluster-creation",level:3},{value:"4. Cluster access and status with kubectl",id:"4-cluster-access-and-status-with-kubectl",level:3},{value:"5. Cluster deletion",id:"5-cluster-deletion",level:3},{value:"Kubernetes cluster considerations",id:"kubernetes-cluster-considerations",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"eks-cluster",children:"EKS cluster"})}),"\n",(0,i.jsx)(s.p,{children:"Feldera Enterprise can be installed on Amazon's Elastic Kubernetes Service (EKS).\nThese instructions detail how to set up a basic EKS Kubernetes cluster."}),"\n",(0,i.jsx)(s.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"A dedicated AWS account (e.g., created using AWS organizations)"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsxs)(s.a,{href:"https://aws.amazon.com/cli/",children:[(0,i.jsx)(s.strong,{children:"aws"})," (AWS CLI)"]}),": ",(0,i.jsx)(s.code,{children:"aws --version"})]}),"\n",(0,i.jsx)(s.p,{children:"Used by eksctl to interact with AWS. Should be configured to work with AWS account."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"https://github.com/weaveworks/eksctl",children:(0,i.jsx)(s.strong,{children:"eksctl"})}),": ",(0,i.jsx)(s.code,{children:"eksctl version"})]}),"\n",(0,i.jsx)(s.p,{children:"Used to bring up and configure EKS cluster"}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/tasks/tools/install-kubectl-linux/",children:(0,i.jsx)(s.strong,{children:"kubectl"})}),": ",(0,i.jsx)(s.code,{children:"kubectl version"})]}),"\n",(0,i.jsx)(s.p,{children:"Used to interact with the deployed EKS cluster"}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{id:"eks-cluster-creation",children:"EKS cluster creation"}),"\n",(0,i.jsx)(s.h3,{id:"1-aws-access",children:"1. AWS access"}),"\n",(0,i.jsxs)(s.p,{children:["Make sure your ",(0,i.jsx)(s.code,{children:"aws"})," CLI is configured to work with your AWS account.\nIf you haven't done so already, run ",(0,i.jsx)(s.code,{children:"aws configure"})," and enter the required credentials.\nThe currently configured user can be checked via:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"aws sts get-caller-identity\n"})}),"\n",(0,i.jsxs)(s.p,{children:["More information can be found in the ",(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/getting-started-eksctl.html",children:"AWS documentation for getting started with eksctl"}),".\n",(0,i.jsx)(s.code,{children:"eksctl"})," uses ",(0,i.jsx)(s.code,{children:"aws"})," behind-the-scenes."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Add ",(0,i.jsx)(s.code,{children:"--profile [profile]"})," to your ",(0,i.jsx)(s.code,{children:"eksctl"})," calls if ",(0,i.jsx)(s.code,{children:"aws"})," CLI is configured with\nmultiple profiles."]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"eksctl"})," requires a set of minimum IAM policies to function as\n",(0,i.jsx)(s.a,{href:"https://eksctl.io/usage/minimum-iam-policies/",children:"outlined in the documentation"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"2-cluster-configuration",children:"2. Cluster configuration"}),"\n",(0,i.jsxs)(s.p,{children:["We will define the cluster using a YAML configuration file which will be applied\nusing ",(0,i.jsx)(s.code,{children:"eksctl"}),". In this configuration file, we will specify cluster aspects, most notably:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Name, region and version"}),"\n",(0,i.jsxs)(s.li,{children:["Use ",(0,i.jsx)(s.a,{href:"https://aws.amazon.com/ebs/",children:"EBS"})," for the allocation of\n",(0,i.jsx)(s.a,{href:"https://kubernetes.io/docs/concepts/storage/persistent-volumes/",children:"persistent volumes"})]}),"\n",(0,i.jsx)(s.li,{children:"Node groups which define the machines the cluster runs on"}),"\n",(0,i.jsxs)(s.li,{children:["A dedicated ",(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/vpc/latest/userguide/what-is-amazon-vpc.html",children:"VPC"})]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["Create a configuration file named ",(0,i.jsx)(s.code,{children:"eks-config.yaml"})," with the following content:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-yaml",children:'# Filename: eks-config.yaml\n\napiVersion: eksctl.io/v1alpha5\nkind: ClusterConfig\nmetadata:\n  name: feldera-cluster\n  region: us-west-1\n  version: "1.30"\n\n# Node groups that can be used to scale the cluster up and down\nmanagedNodeGroups:\n  - name: ng-m5-4xlarge\n    desiredCapacity: 1\n    minSize: 0\n    maxSize: 3\n    instanceType: m5.4xlarge\n    privateNetworking: true\n\n# Virtual private cloud (VPC)\nvpc:\n  clusterEndpoints:\n    privateAccess: true\n    publicAccess:  true\n  # If publicAccess is set to true, it is recommended to limit the\n  # IPs that can connect using this field\n  publicAccessCIDRs: ["<a.b.c.d/32>"]  # Change to your IP range\n\n# Addons with policies attached (e.g., EBS) require OIDC enabled\niam:\n  withOIDC: true\n\n# Addon: AWS Elastic Block Store (EBS) Container Storage Interface (CSI) driver.\n# This addon makes EBS volumes be the storage for Kubernetes persistent volumes.\naddons:\n  - name: aws-ebs-csi-driver\n    wellKnownPolicies:\n      ebsCSIController: true\n'})}),"\n",(0,i.jsxs)(s.admonition,{type:"tip",children:[(0,i.jsxs)(s.p,{children:["Unless you are running ",(0,i.jsx)(s.code,{children:"eksctl"})," and ",(0,i.jsx)(s.code,{children:"kubectl"})," from a machine which is in the\nsame VPC and subnet as the EKS control plane, you will want to set\n",(0,i.jsx)(s.code,{children:"publicAccess: true"}),". If so, we strongly recommend using the\n",(0,i.jsx)(s.code,{children:"publicAccessCIDRs"})," setting to limit IP ranges which are allowed to interact\nwith the EKS control plane. We recommend customers set this to a well-scoped\nnetwork range as they see fit to restrict access to one or more operators in your\ncorporate network."]}),(0,i.jsxs)(s.p,{children:["See the ",(0,i.jsx)(s.a,{href:"https://eksctl.io/usage/vpc-cluster-access/",children:"eksctl cluster access"}),"\ndocumentation to learn more."]})]}),"\n",(0,i.jsx)(s.admonition,{type:"tip",children:(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"eksctl"})," allows additional cluster setup and access configuration beyond what\nwe've shown here. Check out the ",(0,i.jsx)(s.a,{href:"https://eksctl.io/usage/schema/",children:"configuration file schema"}),"\nto learn more."]})}),"\n",(0,i.jsx)(s.h3,{id:"3-cluster-creation",children:"3. Cluster creation"}),"\n",(0,i.jsx)(s.p,{children:"Create the EKS cluster with this configuration."}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"eksctl create cluster -f eks-config.yaml\n"})}),"\n",(0,i.jsxs)(s.p,{children:["It should take roughly 15-20 minutes. This uses CloudFormation behind-the-scenes\nto bring up an EKS cluster named ",(0,i.jsx)(s.code,{children:"feldera-cluster"})," with one EC2 instance as worker node,\nrunning in a newly created dedicated VPC."]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.code,{children:"eksctl"})," will create the VPC in the ",(0,i.jsx)(s.code,{children:"us-west-1"})," region which will run the EKS\ncluster. The cluster will be deployed across two availability zones (AZs). Each\nAZ will have two subnets, one private and one public. The private subnets will\nhave outbound Internet connectivity via a NAT gateway. The public subnets will\nhave inbound and outbound connectivity via an Internet Gateway. The worker\nnodes will only be on the private subnet."]}),"\n",(0,i.jsx)(s.h3,{id:"4-cluster-access-and-status-with-kubectl",children:"4. Cluster access and status with kubectl"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["Follow the ",(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/create-kubeconfig.html",children:"AWS instructions"}),"\nto configure ",(0,i.jsx)(s.code,{children:"kubectl"})," with the newly created EKS cluster"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Verify that the EKS cluster is running:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"kubectl get nodes\n"})}),"\n",(0,i.jsxs)(s.p,{children:["You should see a cluster of a single node, with the status ",(0,i.jsx)(s.code,{children:"Ready"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:"Feldera needs at least a default storage class to allocate persistent volume claims (PVCs).\nUsers can also explicitly specify the storage class per pipeline directly in their configuration."}),"\n",(0,i.jsxs)(s.p,{children:["If you installed the EBS CSI driver as per the instructions above, you should see the ",(0,i.jsx)(s.code,{children:"gp2"})," storage\nclass in your cluster already, marked as the default:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"$ kubectl get sc\nNAME            PROVISIONER             RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE\ngp2 (default)   kubernetes.io/aws-ebs   Delete          WaitForFirstConsumer   false                  64m\n"})}),"\n",(0,i.jsx)(s.p,{children:"If it has not been automatically marked as default (visible next to its name), set it as such using:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'kubectl patch sc gp2 -p \'{"metadata":{"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"5-cluster-deletion",children:"5. Cluster deletion"}),"\n",(0,i.jsx)(s.p,{children:"Cluster deletion can be done by running:"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"eksctl delete cluster -f eks-config.yaml --disable-nodegroup-eviction\n"})}),"\n",(0,i.jsx)(s.h2,{id:"kubernetes-cluster-considerations",children:"Kubernetes cluster considerations"}),"\n",(0,i.jsx)(s.p,{children:"Several important aspects to consider (with some useful links for AWS):"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"General best practices"})," (e.g.,\n",(0,i.jsx)(s.a,{href:"https://aws.github.io/aws-eks-best-practices/",children:"AWS EKS best practices"}),")"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Networking"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"The worker nodes need to access the container registry"}),"\n",(0,i.jsx)(s.li,{children:"The worker nodes need to access the control plane API server"}),"\n",(0,i.jsx)(s.li,{children:"The Feldera installation deployed on the worker nodes need to access\nthe data input sources and output sinks (e.g., databases, Kafka)"}),"\n",(0,i.jsxs)(s.li,{children:["The cluster must be reachable with ",(0,i.jsx)(s.code,{children:"kubectl"})," either directly if publicly accessible\nor indirectly otherwise\n(e.g., via\n",(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html#private-access",children:"bastion"}),",\n",(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/vpn/latest/clientvpn-admin/what-is.html",children:"VPN over a VPC endpoint"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["In general, whether endpoints should be\npublic and/or private (see\n",(0,i.jsx)(s.a,{href:"https://aws.github.io/aws-eks-best-practices/security/docs/iam/#make-the-eks-cluster-endpoint-private",children:"best practices"}),"\nand ",(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/cluster-endpoint.html",children:"AWS documentation"}),")\nor potentially fully-private (see\n",(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/private-clusters.html",children:"AWS"}),"\nor ",(0,i.jsx)(s.a,{href:"https://eksctl.io/usage/eks-private-cluster/",children:"eksctl"})," documentation)"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Volumes"})}),"\n",(0,i.jsxs)(s.p,{children:["The Kubernetes Volumes will need to be backed by a storage method.\nThe Volumes are used both by the Feldera services themselves and the pipelines that are started.\nFor AWS, Elastic Block Store (EBS) can be used (see\n",(0,i.jsx)(s.a,{href:"https://github.com/kubernetes-sigs/aws-ebs-csi-driver",children:"driver repository"}),",\n",(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/eks/latest/userguide/ebs-csi.html",children:"AWS documentation"}),",\n",(0,i.jsx)(s.a,{href:"https://eksctl.io/usage/addons/",children:"eksctl addons"}),")."]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Scale"})}),"\n",(0,i.jsx)(s.p,{children:"It is important to scale the cluster proportional to the workload."}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsx)(s.p,{children:(0,i.jsx)(s.strong,{children:"Security"})}),"\n",(0,i.jsxs)(s.p,{children:["Control access to the server API, the worker nodes and the applications that run on them.\nFor example, in EKS setting up IAM identity mappings (see\n",(0,i.jsx)(s.a,{href:"https://eksctl.io/usage/iam-identity-mappings/",children:"eksctl documentation"}),")."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);