"use strict";(self.webpackChunkfeldera_docs=self.webpackChunkfeldera_docs||[]).push([[5544],{28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>a});var t=i(96540);const r={},s=t.createContext(r);function o(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),t.createElement(s.Provider,{value:n},e.children)}},33110:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>p,frontMatter:()=>o,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"pipelines/sidecar","title":"Running Pipelines with Sidecar Containers","description":"This feature is only available in Feldera Enterprise Edition.","source":"@site/docs/pipelines/sidecar.md","sourceDirName":"pipelines","slug":"/pipelines/sidecar","permalink":"/pipelines/sidecar","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Measuring Pipeline Latency","permalink":"/pipelines/latency"},"next":{"title":"Troubleshooting","permalink":"/operations/guide"}}');var r=i(74848),s=i(28453);const o={},a="Running Pipelines with Sidecar Containers",c={},d=[{value:"Example",id:"example",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"running-pipelines-with-sidecar-containers",children:"Running Pipelines with Sidecar Containers"})}),"\n",(0,r.jsx)(n.admonition,{title:"Enterprise-only feature",type:"note",children:(0,r.jsx)(n.p,{children:"This feature is only available in Feldera Enterprise Edition."})}),"\n",(0,r.jsxs)(n.p,{children:["It is possible to run a ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/pods/sidecar-containers/",children:"sidecar container"}),"\nalongside the main pipeline container in the Enterprise edition.\nIt can be used for example to ingest data from data sources or using data formats\nthat are not currently supported by Feldera connectors. The sidecar can ingest\nsuch data, convert it into one of the supported formats (e.g., JSON), and push it\nto the pipeline using the pipeline's internal HTTP API (*)."]}),"\n",(0,r.jsxs)(n.p,{children:["Sidecar containers are configured through the runtime configuration (",(0,r.jsx)(n.code,{children:"runtime_config"}),")\nof the pipeline by setting its ",(0,r.jsx)(n.code,{children:"runtime_config.init_containers"})," field to\nthe ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#containers",children:(0,r.jsx)(n.em,{children:"PodSpec.initContainers"})}),"\nKubernetes specification formatted as JSON."]}),"\n",(0,r.jsx)(n.p,{children:"This is an advanced feature, so please note the following:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"The internal pipeline API is under active development, and as such it might be that\ncertain endpoints change backward incompatibly and thus require edits to your\nsidecar implementation when upgrading Feldera."}),"\n",(0,r.jsx)(n.li,{children:"Sidecar containers are colocated on the same pod as the pipeline main container,\nand as such are fate-sharing: if the pod goes down, both containers will go down."}),"\n",(0,r.jsx)(n.li,{children:"Sidecar containers share (and thus contend for) resources with the pipeline main\ncontainer, such as CPU and memory. If one of them causes the node of the pod to go OOM,\nboth of them will go down. It is advised to set resources requests and limits for\nsidecar containers."}),"\n",(0,r.jsx)(n.li,{children:"Sidecar containers are currently not tracked or monitored by the Feldera control plane,\nand as such debugging (e.g., retrieving their logs) must be done out-of-band."}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["It is possible to disallow sidecar containers by setting ",(0,r.jsx)(n.code,{children:"pipeline.allowInitContainers"}),"\n(default: ",(0,r.jsx)(n.code,{children:"true"}),") in the Helm chart to ",(0,r.jsx)(n.code,{children:"false"}),". In that case, the pipeline will fail\nto start if the user specifies ",(0,r.jsx)(n.code,{children:"runtime_config.init_containers"}),"."]})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["(*) Documentation for the pipeline's internal HTTP API is not yet available.\nFor now, it requires reading the Rust source code at:\n",(0,r.jsx)(n.a,{href:"https://github.com/feldera/feldera/blob/main/crates/adapters/src/server.rs",children:"https://github.com/feldera/feldera/blob/main/crates/adapters/src/server.rs"})]})}),"\n",(0,r.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,r.jsxs)(n.p,{children:["In the pipeline ",(0,r.jsx)(n.code,{children:"runtime_config.init_containers"}),", you must provide an array\nfollowing the ",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/reference/kubernetes-api/workload-resources/pod-v1/#containers",children:(0,r.jsx)(n.em,{children:"PodSpec.initContainers"})}),"\nKubernetes specification formatted as JSON (more examples can be found on\n",(0,r.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/pods/sidecar-containers/",children:"the Kubernetes sidecar containers documentation page"}),"):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'{\n    "workers": 8,\n    "storage": ...,\n    "fault_tolerance": ...,\n    "resources": ...,\n    "init_containers": [{\n        "name": "example",\n        "image": "ubuntu:24.04",\n        "restartPolicy": "Always",\n        "resources": {\n            "requests": {\n                "memory": "256Mi",\n                "cpu": "250m"\n            },\n            "limits": {\n                "memory": "512Mi",\n                "cpu": "500m"\n            }\n        },\n        "command": ["bash", "-c", "echo \'Hello, world!\'; sleep infinity"]\n    }],\n    ...\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"Check the sidecar logs via:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl logs -n NAMESPACE pipeline-UUID-0 -c example\n"})}),"\n",(0,r.jsx)(n.p,{children:"(replacing NAMESPACE and UUID with the namespace and pipeline identifier respectively)"}),"\n",(0,r.jsx)(n.p,{children:"... which should yield:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Hello, world!\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(l,{...e})}):l(e)}}}]);