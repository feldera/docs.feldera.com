"use strict";(self.webpackChunkfeldera_docs=self.webpackChunkfeldera_docs||[]).push([[3391],{28453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var r=t(96540);const s={},c=r.createContext(s);function i(e){const n=r.useContext(c);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(c.Provider,{value:n},e.children)}},33992:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>i,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"connectors/secret-references","title":"Secret references","description":"Rather than directly supplying a secret (e.g., passwords, PEM, etc.) in the connector","source":"@site/docs/connectors/secret-references.md","sourceDirName":"connectors","slug":"/connectors/secret-references","permalink":"/connectors/secret-references","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Synchronous Processing with Completion Tokens","permalink":"/connectors/completion-tokens"},"next":{"title":"Input connectors","permalink":"/connectors/sources/"}}');var s=t(74848),c=t(28453);const i={},o="Secret references",a={},l=[{value:"Kubernetes",id:"kubernetes",level:2},{value:"Usage",id:"usage",level:3},{value:"Example",id:"example",level:3},{value:"Restrictions",id:"restrictions",level:2}];function d(e){const n={admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"secret-references",children:"Secret references"})}),"\n",(0,s.jsxs)(n.p,{children:["Rather than directly supplying a secret (e.g., passwords, PEM, etc.) in the connector\nconfiguration as a string, it is possible to refer to (externalize) them. This mechanism\nin Feldera is called a ",(0,s.jsx)(n.strong,{children:"secret reference"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"A secret reference is a string in the connector configuration JSON which takes a specific format:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"${secret:<provider>:<identifier>}\n"})}),"\n",(0,s.jsx)(n.p,{children:"It refers to an identifiable secret provided by a provider. Feldera's control plane mounts the secret\ninto the pipeline. When the pipeline initializes, it will replace the secret references in the\nconfiguration with their values. We currently only support a single secret provider, Kubernetes."}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"\u26a0\ufe0f Feldera resolves secrets once at pipeline startup.  Checkpointed state for\nfault tolerant pipelines and suspended pipelines will contain\nresolved secrets."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"kubernetes",children:"Kubernetes"}),"\n",(0,s.jsx)(n.h3,{id:"usage",children:"Usage"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"${secret:kubernetes:<name>/<data key>}\n"})}),"\n",(0,s.jsx)(n.p,{children:"... in which:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"<name>"})," should correspond to a Kubernetes ",(0,s.jsx)(n.code,{children:"Secret"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"<data key>"})," should correspond to a data key value (i.e., in its ",(0,s.jsx)(n.code,{children:"data:"})," section)"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Upon provisioning the pipeline, the runner will mount the Kubernetes Secret data keys\nas files at: ",(0,s.jsx)(n.code,{children:"/etc/feldera-secrets/kubernetes/<name>/<data key>"}),"."]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["In the Enterprise edition, it is possible to limit secret references to only\nthe Secrets on an allowlist by setting in the Helm chart\n",(0,s.jsx)(n.code,{children:"kubernetesRunner.connectorKubernetesSecrets.enableAllowlist"})," to ",(0,s.jsx)(n.code,{children:"true"})," and\n",(0,s.jsx)(n.code,{children:"kubernetesRunner.connectorKubernetesSecrets.allowlist"})," to the list of allowed\nSecret names. See the Helm chart ",(0,s.jsx)(n.code,{children:"values.yaml"})," for more information."]})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["The automatic resolution of Kubernetes Secrets through mounting is Enterprise-only.\nIn the Open Source edition, it is still possible to refer to secrets by carefully\nmounting them yourself out-of-band at ",(0,s.jsx)(n.code,{children:"/etc/feldera-secrets/kubernetes/<name>/<data key>"}),"."]})}),"\n",(0,s.jsx)(n.h3,{id:"example",children:"Example"}),"\n",(0,s.jsxs)(n.p,{children:["Suppose we have a Kubernetes secret as follows (",(0,s.jsx)(n.code,{children:"Zmx5aW5nZmlzaA=="})," = base64-encoded string ",(0,s.jsx)(n.code,{children:"flyingfish"}),")\nin the same namespace as the Feldera deployment."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: example1\ndata:\n  value2: Zmx5aW5nZmlzaA==\n"})}),"\n",(0,s.jsxs)(n.p,{children:["We can then specify a connector configuration that refers to it using ",(0,s.jsx)(n.code,{children:"${secret:kubernetes:example1/value2}"}),"."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n    "transport": {\n        "name": "kafka_input",\n        "config": {\n            ...\n            "sasl.password": "${secret:kubernetes:example1/value2}"\n        },\n    }\n    "format": ...\n}\n'})}),"\n",(0,s.jsx)(n.h2,{id:"restrictions",children:"Restrictions"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The secret name may only contain lowercase alphanumeric characters or hyphens, must start and end\nwith a lowercase alphanumeric character and can be at most 63 characters long"}),"\n",(0,s.jsx)(n.li,{children:"The secret data key has the same restrictions except that it can be at most 255 characters long"}),"\n",(0,s.jsx)(n.li,{children:"Only when the pipeline is started will secret references be checked and resolved"}),"\n",(0,s.jsxs)(n.li,{children:["It is not possible to have any plain string value which starts with ",(0,s.jsx)(n.code,{children:"${secret:"})," and ends with ",(0,s.jsx)(n.code,{children:"}"}),"\nwithout it being identified to be a secret reference."]}),"\n",(0,s.jsxs)(n.li,{children:["Only string values in the connector configuration JSON under ",(0,s.jsx)(n.code,{children:"transport.config"})," and ",(0,s.jsx)(n.code,{children:"format.config"}),"\ncan be identified to be secret references (this excludes keys), for example (secret named ",(0,s.jsx)(n.code,{children:"a"})," at\ndata key ",(0,s.jsx)(n.code,{children:"b"})," has value ",(0,s.jsx)(n.code,{children:"value"}),"):","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n  "transport": {\n    "name": "some_transport",\n    "config": {\n      "${secret:kubernetes:a/b}": "${secret:kubernetes:a/b}",\n      "v1": "${secret:kubernetes:a/b}",\n      "v2": [ "${secret:kubernetes:a/b}" ]\n    }\n  },\n  "format": {\n    "name": "some_format",\n    "config": {\n      "v3": "${secret:kubernetes:a/b}"\n    }\n  },\n  "index": "${secret:kubernetes:a/b}"\n}\n'})}),"\n","... will be resolved to:","\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:'{\n  "transport": {\n    "name": "some_transport",\n    "config": {\n      "${secret:kubernetes:a/b}": "value",\n      "v1": "value",\n      "v2": [ "value" ]\n    }\n  },\n  "format": {\n    "name": "some_format",\n    "config": {\n      "v3": "value"\n    }\n  },\n  "index": "${secret:kubernetes:a/b}"\n}\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Because connector configuration is validated during SQL compilation without secret\nresolution, string values that require certain format for the connector configuration\nto be valid will not allow secret references (enumerations in particular, such as for\nthe datagen connector ",(0,s.jsx)(n.code,{children:"strategy"})," field)"]}),"\n",(0,s.jsx)(n.li,{children:"It is not possible to specify a secret value type other than string"}),"\n",(0,s.jsxs)(n.li,{children:["It is not possible to specify a secret as a substring, for example\n",(0,s.jsx)(n.code,{children:"abc${secret:kubernetes:a/b}def"})," does not work"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);