"use strict";(self.webpackChunkfeldera_docs=self.webpackChunkfeldera_docs||[]).push([[9689],{28453:(e,n,r)=>{r.d(n,{R:()=>c,x:()=>t});var s=r(96540);const i={},l=s.createContext(i);function c(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:c(e.components),s.createElement(l.Provider,{value:n},e.children)}},34722:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>t,default:()=>h,frontMatter:()=>c,metadata:()=>s,toc:()=>o});const s=JSON.parse('{"id":"get-started/enterprise/parallel-compilation","title":"Parallel Compilation","description":"Parallel compilation allows Feldera to compile multiple pipelines concurrently by distributing the workload across several compiler server pods. This dramatically reduces total compile time for large numbers of pipelines, especially in production environments.","source":"@site/docs/get-started/enterprise/parallel-compilation.md","sourceDirName":"get-started/enterprise","slug":"/get-started/enterprise/parallel-compilation","permalink":"/get-started/enterprise/parallel-compilation","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"HTTPS","permalink":"/get-started/enterprise/https"},"next":{"title":"Guides and Tutorials","permalink":"/tutorials/"}}');var i=r(74848),l=r(28453);const c={},t="Parallel Compilation",a={},o=[{value:"How Parallel Compilation Works",id:"how-parallel-compilation-works",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Enabling Parallel Compilation",id:"enabling-parallel-compilation",level:3},{value:"Setting Up sccache (Optional, Recommended)",id:"setting-up-sccache-optional-recommended",level:3},{value:"Troubleshooting &amp; FAQs",id:"troubleshooting--faqs",level:2},{value:"Configuration Options Reference",id:"configuration-options-reference",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"parallel-compilation",children:"Parallel Compilation"})}),"\n",(0,i.jsx)(n.p,{children:"Parallel compilation allows Feldera to compile multiple pipelines concurrently by distributing the workload across several compiler server pods. This dramatically reduces total compile time for large numbers of pipelines, especially in production environments."}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"how-parallel-compilation-works",children:"How Parallel Compilation Works"}),"\n",(0,i.jsxs)(n.p,{children:["Feldera deploys the compiler server as a Kubernetes StatefulSet with ",(0,i.jsx)(n.strong,{children:"N"})," replicas. Each replica (pod) acts as a worker responsible for compiling a subset of pipelines. The assignment is deterministic:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Each pipeline is assigned to a worker using:\n",(0,i.jsx)(n.code,{children:"pipeline_id % N == worker_id"}),"\nThe worker ID is the pod index (e.g., ",(0,i.jsx)(n.code,{children:"feldera-compiler-server-1"})," has worker ID ",(0,i.jsx)(n.code,{children:"1"}),")."]}),"\n",(0,i.jsx)(n.li,{children:"Each pod compiles only the pipelines assigned to it."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Worker 0"})," (the pod with index 0) acts as the leader. All other workers transfer their compiled binaries to the leader over HTTP/HTTPS before marking the program as successfully compiled."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["To further accelerate builds, Feldera optionally supports ",(0,i.jsx)(n.a,{href:"https://github.com/mozilla/sccache",children:"sccache"})," with an S3-compatible backend. This allows workers to share compiled operator artifacts instead of rebuilding identical code."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"Autoscaling based on workload is not yet supported. You must set the number of compiler server replicas at install time or scale them manually later."})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"enabling-parallel-compilation",children:"Enabling Parallel Compilation"}),"\n",(0,i.jsx)(n.p,{children:"To enable parallel compilation with 3 compiler server replicas:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["Via file ",(0,i.jsx)(n.code,{children:"values.yaml"})]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"parallelCompilation:\n  # Enable parallel compilation features\n  enabled: true\n  # Number of compiler server replicas when parallel compilation is enabled\n  replicas: 3\n  # ...other configuration\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"In Helm command"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'helm upgrade --install feldera \\\n  oci://public.ecr.aws/feldera/feldera-chart --version "${VERSION}" \\\n  --namespace feldera \\\n  --set parallelCompilation.enabled=true \\\n  --set parallelCompilation.replicas=3 \\\n  # ...other configuration\n'})}),"\n",(0,i.jsx)(n.p,{children:"You should see multiple compiler server pods, for example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n feldera\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"NAME                          READY   STATUS    RESTARTS   AGE\nfeldera-compiler-server-0     1/1     Running   0          2m\nfeldera-compiler-server-1     1/1     Running   0          2m\nfeldera-compiler-server-2     1/1     Running   0          2m\nfeldera-api-server-xxx        1/1     Running   0          2m\nfeldera-kubernetes-runner-xxx 1/1     Running   0          2m\nfeldera-db-0                  1/1     Running   0          2m\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"setting-up-sccache-optional-recommended",children:"Setting Up sccache (Optional, Recommended)"}),"\n",(0,i.jsx)(n.p,{children:"Compiler server has all dependcies percompiled in it's target directory. We only need to perform compilation of the program generated based on the pipeline SQL."}),"\n",(0,i.jsx)(n.p,{children:"If there is just 1 compiler server,  sccache does not provide any benefit as dependencies are already there and as all pipelines are compiled in same workspace, the operators and other compiled artifacts are shared."}),"\n",(0,i.jsx)(n.p,{children:"When there are multiple compiler server, that is when we want to make sure operators compiled on a server are reusable by others, and sccache achieves that."}),"\n",(0,i.jsxs)(n.p,{children:["Example:\nPipeline A uses operator ",(0,i.jsx)(n.code,{children:"xx"})," and is assigned to pod 0. Pod 0 builds ",(0,i.jsx)(n.code,{children:"xx"}),". Later pipeline B, assigned to pod 1, also needs ",(0,i.jsx)(n.code,{children:"xx"}),". Without sccache, pod 1 rebuilds ",(0,i.jsx)(n.code,{children:"xx"})," from scratch. With sccache (S3/MinIO backend), pod 1 fetches the cached object files, avoiding a full rebuild."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"1. Provision S3 Credentials"})}),"\n",(0,i.jsx)(n.p,{children:"Use either IRSA (IAM Roles for Service Accounts) or a Kubernetes secret with S3 credentials. sccache uses these credentials to access the cache bucket."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"IRSA"}),": The compiler server checks for ",(0,i.jsx)(n.code,{children:"AWS_ROLE_ARN"})," and ",(0,i.jsx)(n.code,{children:"AWS_WEB_IDENTITY_TOKEN_FILE"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Kubernetes Secret"}),": Create a secret containing your S3 access keys:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'kubectl create secret generic sccache-s3-secret -n feldera \\\n  --from-literal=access_key_id="your-access-key" \\\n  --from-literal=secret_access_key="your-secret-key"\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The secret must define keys ",(0,i.jsx)(n.code,{children:"access_key_id"})," and ",(0,i.jsx)(n.code,{children:"secret_access_key"}),". You can configure the secret name in ",(0,i.jsx)(n.code,{children:"values.yaml"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsxs)(n.strong,{children:["2. Configure sccache in ",(0,i.jsx)(n.code,{children:"values.yaml"})]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'parallelCompilation:\n  enabled: true\n  replicas: 3\n  # sccache configuration for sharing compilation artifacts between compiler servers\n  sccache:\n    # Enable sccache for compilation artifact caching (optional, recommended)\n    enabled: true\n    # S3 backend configuration for sccache\n    s3:\n      # S3 bucket name for cache storage\n      bucket: "sccache-bucket"\n      # Use SSL for S3 connections\n      # set to true to use HTTPS/TLS\n      useSSL: false\n      # Key prefix for cache objects used by sccache\n      keyPrefix: "sccache"\n      # AWS region of bucket\n      region: "us-east-1"\n      # custom URL ( <ip>:<port> ) of a server you want to use, such as MinIO.\n      # Defaults to ${BUCKET}.s3-{REGION}.amazonaws.com for AWS S3 if not set.\n      # endpoint: "minio.extra.svc.cluster.local:9000"\n      #\n      # Server-side encryption (optional)\n      # serverSideEncryption: false\n      #\n      # Existing secret containing S3 credentials\n      # The secret must have keys: access_key_id and secret_access_key\n      # If IRSA is setup, you don\'t need to specify existingSecret,\n      # credentials would be configured via AWS_ROLE_ARN and AWS_WEB_IDENTITY_TOKEN_FILE\n      # environment variables automatically.\n      # existingSecret: "sccache-s3-secret"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting--faqs",children:"Troubleshooting & FAQs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Resource requirements:"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Ensure your cluster nodes have enough resources to run the desired number of compiler server replicas."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"Pipeline stuck on some status:"})}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"If a pipeline is assigned to a worker pod that is not yet running or is unhealthy, it will not be compiled until that pod is available and running. Make sure to validate all pods are running."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"SystemError: Failed to upload binary:"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["If the pipeline gets this status, that means pod N failed to upload its binary to ",(0,i.jsx)(n.code,{children:"<_>-compiler-server-0"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["You can check if ",(0,i.jsx)(n.code,{children:"<_>-compiler-server-0"})," is healthy or not by ",(0,i.jsx)(n.code,{children:"/cluster_healthz"})," endpoint. Make sure to adjust binary upload related configuration as per your needs, e.g. if your ",(0,i.jsx)(n.em,{children:"upgrade"})," takes a while, we should configure retries and backoff interval to sane values such that pods get time to come up to receive the binary."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsxs)(n.strong,{children:["error: process didn't exit successfully: ",(0,i.jsx)(n.code,{children:"sccache .. rustc -vV"}),":"]})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Check the ",(0,i.jsx)(n.code,{children:"Errors"})," tab in web console ( enable ",(0,i.jsx)(n.code,{children:"Verbatim errors"})," if required ) to check full error regarding why sccache failed."]}),"\n",(0,i.jsx)(n.p,{children:"Comman causes can be misconfigured S3 bucket / endpoint / credentials."}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Scaling with kubectl:"})," If you scale the compiler server StatefulSet using ",(0,i.jsx)(n.code,{children:"kubectl"})," without restarting, the compiler server will detect the change and panic with ",(0,i.jsx)(n.code,{children:"SCALING DETECTED: StatefulSet has X replicas but compiler was started with Y workers"}),". This would trigger a restart to ensure correct work distribution."]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"configuration-options-reference",children:"Configuration Options Reference"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Key"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Default/Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parallelCompilation.enabled"})}),(0,i.jsx)(n.td,{children:"Enable parallel compilation"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"false"})," (ex: ",(0,i.jsx)(n.code,{children:"true"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parallelCompilation.replicas"})}),(0,i.jsx)(n.td,{children:"Number of compiler server pods"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"1"})," (ex: ",(0,i.jsx)(n.code,{children:"3"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parallelCompilation.sccache.enabled"})}),(0,i.jsx)(n.td,{children:"Enable sccache build cache"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"false"})," (ex: ",(0,i.jsx)(n.code,{children:"true"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parallelCompilation.sccache.s3.bucket"})}),(0,i.jsx)(n.td,{children:"S3/MinIO bucket for cache"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"sccache-bucket"'})," (ex: ",(0,i.jsx)(n.code,{children:'"feldera-sccache"'}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parallelCompilation.sccache.s3.useSSL"})}),(0,i.jsx)(n.td,{children:"Use SSL/TLS for S3/MinIO"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"false"})," (ex: ",(0,i.jsx)(n.code,{children:"true"}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parallelCompilation.sccache.s3.region"})}),(0,i.jsx)(n.td,{children:"Bucket region"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"us-east-1"'})," (ex: ",(0,i.jsx)(n.code,{children:'"us-east-1"'}),")"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parallelCompilation.sccache.s3.keyPrefix"})}),(0,i.jsx)(n.td,{children:"Cache object key prefix"}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:'"sccache"'})," (ex: ",(0,i.jsx)(n.code,{children:'"sccache"'})," or ",(0,i.jsx)(n.code,{children:'""'}),")"]})]})]})]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Optional Configurations"})}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Key"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Example"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parallelCompilation.sccache.s3.existingSecret"})}),(0,i.jsx)(n.td,{children:"Secret for S3 credentials (omit if using IRSA)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"sccache-s3-secret"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parallelCompilation.sccache.s3.serverSideEncryption"})}),(0,i.jsx)(n.td,{children:"Enable server-side encryption with s3 managed key (SSE-S3)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"false"})})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"parallelCompilation.sccache.s3.endpoint"})}),(0,i.jsx)(n.td,{children:"Custom endpoint (e.g. MinIO)"}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"minio.mydomain.com:9000"})})]})]})]}),"\n",(0,i.jsx)(n.hr,{})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);