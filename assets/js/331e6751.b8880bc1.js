"use strict";(self.webpackChunkfeldera_docs=self.webpackChunkfeldera_docs||[]).push([[1072],{22714:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"pipelines/fault-tolerance","title":"Fault tolerance and checkpoint/resume","description":"Feldera supports the following ways to gracefully stop a pipeline and","source":"@site/docs/pipelines/fault-tolerance.md","sourceDirName":"pipelines","slug":"/pipelines/fault-tolerance","permalink":"/pipelines/fault-tolerance","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Settings","permalink":"/pipelines/configuration"},"next":{"title":"Synchronizing checkpoints to object store","permalink":"/pipelines/checkpoint-sync"}}');var s=n(74848),r=n(28453);const l={},o="Fault tolerance and checkpoint/resume",c={},a=[{value:"Implementation",id:"implementation",level:2},{value:"Fault-tolerant connectors",id:"fault-tolerant-connectors",level:2},{value:"Enabling checkpoint and resume and fault tolerance",id:"enabling-checkpoint-and-resume-and-fault-tolerance",level:2},{value:"Writing checkpoints",id:"writing-checkpoints",level:2}];function h(e){const t={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"fault-tolerance-and-checkpointresume",children:"Fault tolerance and checkpoint/resume"})}),"\n",(0,s.jsx)(t.p,{children:"Feldera supports the following ways to gracefully stop a pipeline and\nlater restart it from the same point:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Pause and resume.  A paused pipeline continues to run and occupy\nmemory on its host, but it does not ingest any more input until\nresumed.  A paused pipeline does finish processing input it has\nalready ingested; afterward, it uses only enough CPU to answer HTTP\nrequests."}),"\n",(0,s.jsx)(t.p,{children:"In the web UI, the \u23f8\ufe0f button pauses a pipeline and \u25b6\ufe0f resumes it."}),"\n",(0,s.jsx)(t.p,{children:"Every Feldera pipeline supports pause and resume."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Checkpoint and resume.  The \u23f9\ufe0f Stop button in the UI writes a\ncheckpoint to storage and then exits.  When the user resumes the\npipeline with \u25b6\ufe0f Start, it uses the checkpoint to resume from the\nexact point where it left off, without dropping or duplicating input\nor output."}),"\n",(0,s.jsx)(t.p,{children:"Checkpointing a pipeline allows it to resume gracefully on a\ndifferent host or with a modified configuration.  With Feldera\ndeployed in Kubernetes, when a pipeline exit, it terminates its\ncurrent pod while keeping its state in EBS or S3.  The pipeline can\nthen resume in a new pod which can have more or fewer resources than\nthe original pod."}),"\n",(0,s.jsx)(t.p,{children:"Resume does not delete the checkpoint that it uses.  This means\nthat, if the pipeline crashes or if it is stopped abruptly with \u23f9\ufe0f\nForce Stop, and then later restarts, it will resume a second time\nfrom the same point."}),"\n",(0,s.jsxs)(t.p,{children:["Checkpoint support is in the Feldera enterprise edition only.  For a\npipeline to support checkpoints, a pipeline must use ",(0,s.jsx)(t.a,{href:"#fault-tolerant-connectors",children:"fault-tolerant\nconnectors"})," and have storage configured."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"At-least-once fault tolerance.  The pipeline regularly (by default,\nevery minute) writes a checkpoint to storage.  If the pipeline\ncrashes, then it resumes from the most recent checkpoint, restarting\ninput connectors from the point just before the checkpoint.  Any\noutput already produced beyond the checkpoint will be produced\nagain, meaning that, overall, output records are produced at least\nonce."}),"\n",(0,s.jsx)(t.p,{children:"At-least-once fault tolerance is in the Feldera enterprise edition\nonly, with the same configuration requirements as checkpoint and\nresume.  Writing checkpoints has some performance cost so, in\naddition, it must be enabled explicitly on a pipeline."}),"\n",(0,s.jsx)(t.p,{children:"An at-least-once fault tolerant pipeline can also be checkpointed\nand resumed."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Exactly once fault tolerance.  This extends at-least-once fault\ntolerance with input and output journaling so that the pipeline\nrestarts from the exact state prior to any unplanned, abrupt\nshutdown or crash.  Restart of a fault-tolerant pipeline does not\ndrop or duplicate input or output, meaning that each output record\nis produced exactly once."}),"\n",(0,s.jsx)(t.p,{children:"Exactly once fault tolerance is in the Feldera enterprise edition\nonly, with the same configuration requirements as checkpoint and\nresume.  Journaling adds some performance cost to periodic\ncheckpointing so, in addition, it must be enabled explicitly on a\npipeline."}),"\n",(0,s.jsx)(t.p,{children:"A fault-tolerant pipeline can also be checkpointed and resumed."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:["\u26a0\ufe0f Feldera resolves ",(0,s.jsx)(t.a,{href:"/connectors/secret-references",children:"secrets"}),"\neach time a pipeline starts or resumes, without saving resolved\nsecrets to checkpoints or journals."]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"The following sections describes these features in more detail."}),"\n",(0,s.jsx)(t.h2,{id:"implementation",children:"Implementation"}),"\n",(0,s.jsxs)(t.p,{children:["Feldera implements these features by writing a ",(0,s.jsx)(t.strong,{children:"checkpoint"})," to\nstorage, that is, a consistent snapshot of the Feldera system's state,\nincluding computation and the input and output connectors.  On resume,\nFeldera loads its state from the checkpoint, and then restarts each of\nthe connectors at the point where it left off."]}),"\n",(0,s.jsxs)(t.p,{children:["In addition, exactly once fault tolerance writes additional data to a\nseparate ",(0,s.jsx)(t.strong,{children:"journal"})," between checkpoints.  For each batch of data that\nFeldera processes through the pipeline, it writes enough information\nto the journal to obtain another copy of the batch's input data later."]}),"\n",(0,s.jsx)(t.p,{children:"When an exactly once fault-tolerant pipeline restarts, it loads its\nstate from the most recent checkpoint, then it replays any data from\ninput connectors previously processed beyond that checkpoint.  If\nreplay produces output that was previously sent to output connectors,\nit discards that output.  After replay completes, the pipeline\ncontinues with new input that has not previously been processed."}),"\n",(0,s.jsx)(t.h2,{id:"fault-tolerant-connectors",children:"Fault-tolerant connectors"}),"\n",(0,s.jsx)(t.p,{children:"For Feldera to checkpoint and resume, or to enable fault-tolerance, all\nof the pipeline's input connectors must support fault tolerance.  Some\ninput connectors do not yet support fault tolerance and therefore may\nnot be part of a pipeline that supports these features.  Input\nconnectors individually document their support for fault tolerance."}),"\n",(0,s.jsxs)(t.p,{children:["For a pipeline to fully support either feature, its output connectors\nmust also be fault tolerant.  Only the ",(0,s.jsx)(t.a,{href:"/connectors/sinks/kafka",children:"Kafka output\nconnector"})," supports fault tolerance as of\nnow.  If a fault-tolerant pipeline includes non-fault-tolerant output\nconnectors, then in the event of a crash and restart, Feldera may send\nduplicate output to those connectors, but it will not drop output."]}),"\n",(0,s.jsxs)(t.p,{children:["Feldera does not yet support fault tolerance or checkpoint and resume in\npipelines that use the SQL ",(0,s.jsx)(t.code,{children:"NOW"})," function."]}),"\n",(0,s.jsx)(t.p,{children:"The following table documents input connector support for fault\ntolerance."}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"Input connector"}),(0,s.jsx)(t.th,{style:{textAlign:"center"},children:"Checkpoint and resume"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"At-least-once FT"}),(0,s.jsx)(t.th,{style:{textAlign:"right"},children:"Exactly once FT"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/datagen",children:"Datagen"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/debezium",children:"Debezium"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/delta",children:"Delta Lake"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2610"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/http-get",children:"HTTP GET (URL)"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/http",children:"HTTP"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/iceberg",children:"Iceberg"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2610"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2610"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2610"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/kafka",children:"Kafka"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/postgresql",children:"PostgreSQL"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2610"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2610"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2610"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/pubsub",children:"Pub/Sub"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2610"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2610"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2610"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/s3",children:"S3"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"right"},children:(0,s.jsx)(t.a,{href:"/connectors/sources/file",children:"File"})}),(0,s.jsx)(t.td,{style:{textAlign:"center"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"}),(0,s.jsx)(t.td,{style:{textAlign:"right"},children:"\u2611"})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"enabling-checkpoint-and-resume-and-fault-tolerance",children:"Enabling checkpoint and resume and fault tolerance"}),"\n",(0,s.jsx)(t.p,{children:"To enable checkpoint and resume or fault tolerance in an enterprise\nFeldera pipeline:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Ensure that all of the pipeline's connectors support fault tolerance, as\ndescribed in the previous section."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Recent versions of Feldera enable storage in new pipelines by\ndefault.  If storage is not yet enabled, enable it in one of the\nfollowing ways:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["In the web UI, click on the gear icon \u2699\ufe0f.  In the dialog box,\nchange ",(0,s.jsx)(t.code,{children:"storage"})," to ",(0,s.jsx)(t.code,{children:"{}"}),", e.g.:"]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.img,{alt:"Fault tolerance configuration",src:n(61482).A+"",width:"512",height:"514"})}),"\n",(0,s.jsxs)(t.p,{children:["Then click on the Apply button.  (For more storage options, click\non the \u2699\ufe0f again, to see that ",(0,s.jsx)(t.code,{children:"{}"})," has been expanded to show the\navailable settings.)"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Using the ",(0,s.jsx)(t.code,{children:"fda"})," command line tool:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"fda set-config <pipeline> storage true\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"To additionally enable fault tolerance:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["In the web UI, click on the gear icon \u2699\ufe0f.  In the dialog box,\ninside ",(0,s.jsx)(t.code,{children:"fault_tolerance"}),":"]}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Change ",(0,s.jsx)(t.code,{children:"model"})," to ",(0,s.jsx)(t.code,{children:'"at_least_once"'})," or ",(0,s.jsx)(t.code,{children:'"exactly_once"'}),"."]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Optionally, change ",(0,s.jsx)(t.code,{children:'"checkpoint_interval_secs"'})," to an automatic\ncheckpoint interval of your choice, in seconds, or to ",(0,s.jsx)(t.code,{children:"null"})," to\ndisable automatic checkpoints."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.p,{children:"Then, click on the Apply button.  If clicking on Apply does not\ndismiss the dialog box, then either storage has not been enabled\nor the running version of Feldera is not the enterprise edition."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["With the ",(0,s.jsx)(t.code,{children:"fda"})," command line tool, use one of these commands to\nenable fault tolerance:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"fda set-config <pipeline> fault_tolerance at_least_once\nfda set-config <pipeline> fault_tolerance exactly_once\n"})}),"\n",(0,s.jsxs)(t.p,{children:["Optionally, use the following command to change the automatic\ncheckpointing interval to ",(0,s.jsx)(t.code,{children:"<seconds>"})," (use ",(0,s.jsx)(t.code,{children:"0"})," for ",(0,s.jsx)(t.code,{children:"<seconds>"})," to\ndisable automatic checkpoints):"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{children:"fda set-config <pipeline> checkpoint_interval <seconds>\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"writing-checkpoints",children:"Writing checkpoints"}),"\n",(0,s.jsxs)(t.p,{children:["When fault tolerance is enabled as described, by default Feldera\nautomatically writes a checkpoint every 60 seconds.  This interval can\nbe changed to another value, or disabled entirely, as described\n",(0,s.jsx)(t.a,{href:"#enabling-checkpoint-and-resume-and-fault-tolerance",children:"above"}),"."]}),"\n",(0,s.jsxs)(t.p,{children:["Feldera also has an HTTP API, ",(0,s.jsx)(t.code,{children:"/checkpoint"}),", that allows the user to\nrequest writing a checkpoint immediately.  If automatic checkpoints\nare disabled, then the user should occasionally invoke this API to\nensure that the checkpoint feature is useful."]}),"\n",(0,s.jsxs)(t.blockquote,{children:["\n",(0,s.jsxs)(t.p,{children:["\u26a0\ufe0f Writing a checkpoint should ordinarily be a fairly fast operation\nthat takes several seconds.  However, the ",(0,s.jsx)(t.a,{href:"/connectors/sources/delta",children:"Delta Lake input\nconnector"})," can only checkpoint at some\ninput positions.  When a checkpoint is requested between those points,\nFeldera will execute steps that draw input only from those connectors\nuntil they advance to a point at which a checkpoint is possible, and\nthen write the checkpoint.  In some cases, this can take minutes or\nlonger."]}),"\n"]})]})}function d(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},28453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>o});var i=n(96540);const s={},r=i.createContext(s);function l(e){const t=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),i.createElement(r.Provider,{value:t},e.children)}},61482:(e,t,n)=>{n.d(t,{A:()=>i});const i=n.p+"assets/images/fault-tolerance-24003c18288d4ac0a872887738c3cb3f.png"}}]);