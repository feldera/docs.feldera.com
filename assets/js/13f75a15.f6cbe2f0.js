"use strict";(self.webpackChunkfeldera_docs=self.webpackChunkfeldera_docs||[]).push([[8418],{28453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>l});var s=r(96540);const i={},o=s.createContext(i);function t(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(o.Provider,{value:n},e.children)}},51668:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"operations/guide","title":"Troubleshooting","description":"This guide covers issues Feldera Enterprise users and operators might run into in production, and steps to remedy them.","source":"@site/docs/operations/guide.md","sourceDirName":"operations","slug":"/operations/guide","permalink":"/operations/guide","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Measuring Pipeline Latency","permalink":"/pipelines/latency"},"next":{"title":"Pipeline Metrics","permalink":"/operations/metrics"}}');var i=r(74848),o=r(28453);const t={},l="Troubleshooting",c={},a=[{value:"Common Error Messages",id:"common-error-messages",level:2},{value:"Delta Lake Connection Errors",id:"delta-lake-connection-errors",level:3},{value:"Out-of-Memory Errors",id:"out-of-memory-errors",level:3},{value:"Out-of-storage Errors",id:"out-of-storage-errors",level:3},{value:"Kubernetes evictions",id:"kubernetes-evictions",level:3},{value:"Rust Compilation Errors",id:"rust-compilation-errors",level:3},{value:"Diagnosing Performance Issues",id:"diagnosing-performance-issues",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"troubleshooting",children:"Troubleshooting"})}),"\n",(0,i.jsx)(n.p,{children:"This guide covers issues Feldera Enterprise users and operators might run into in production, and steps to remedy them."}),"\n",(0,i.jsx)(n.h2,{id:"common-error-messages",children:"Common Error Messages"}),"\n",(0,i.jsx)(n.h3,{id:"delta-lake-connection-errors",children:"Delta Lake Connection Errors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error"}),": ",(0,i.jsx)(n.code,{children:"Table metadata is invalid: Number of checkpoint files '0' is not equal to number of checkpoint metadata parts 'None'"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": This usually happens when the Delta Table uses features unsupported by ",(0,i.jsx)(n.code,{children:"delta-rs"}),' like liquid clustering or deletion vectors. Check the table properties and set the checkpoint policy to "classic":']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:"ALTER TABLE my_table SET TBLPROPERTIES (\n  'checkpointPolicy' = 'classic'\n)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"out-of-memory-errors",children:"Out-of-Memory Errors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error"}),": ",(0,i.jsx)(n.code,{children:"The pipeline container has restarted. This was likely caused by an Out-Of-Memory (OOM) crash."})]}),"\n",(0,i.jsx)(n.p,{children:"Feldera runs each pipeline in a separate container with configurable memory limits. Here are some knobs to\ncontrol memory usage:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Adjust the pipeline\u2019s memory reservation and limit:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"resources": {\n    "memory_mb_min": 32000,\n    "memory_mb_max": 32000\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Throttle the amount of records buffered by the connector using the ",(0,i.jsx)(n.a,{href:"https://docs.feldera.com/connectors/#generic-attributes",children:(0,i.jsx)(n.code,{children:"max_queued_records"})})," setting:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"max_queued_records": 100000\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Ensure that storage is enabled (it's on by default):"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"storage": {\n    "backend": {\n      "name": "default"\n    },\n    "min_storage_bytes": null,\n    "compression": "default",\n    "cache_mib": null\n},\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Optimize your SQL queries to avoid expensive\ncross-products. Use functions like\n",(0,i.jsx)(n.a,{href:"https://docs.feldera.com/sql/datetime/#now",children:"NOW()"})," sparingly on large relations."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"out-of-storage-errors",children:"Out-of-storage Errors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error"}),": The pipeline logs contain messages like:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"DBSP error: runtime error: One or more worker threads terminated unexpectedly\nworker thread 0 panicked\npanic message: called `Result::unwrap()` on an `Err` value: StdIo(StorageFull)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Increase pipeline storage capacity"]}),"\n",(0,i.jsxs)(n.p,{children:["In the Enterprise edition, Feldera runs each pipeline in a separate pod and, by\ndefault, attaches PVC volumes for storage. The default volume size is 30 GB,\nand if your pipelines are encountering ",(0,i.jsx)(n.code,{children:"StorageFull"})," errors, you should\nexplicitly request larger volumes for each pipeline:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"resources": {\n    "storage_mb_max": 128000\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"kubernetes-evictions",children:"Kubernetes evictions"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error"}),": the pipeline becomes ",(0,i.jsx)(n.code,{children:"UNAVAILABLE"})," with no errors in the logs."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": configure resource reservations and limits for the Pipeline."]}),"\n",(0,i.jsx)(n.p,{children:"Kubernetes may evict Pipeline pods under node resource pressure. To confirm, run:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"kubectl describe pipeline-<pipeline-id>-0\n"})}),"\n",(0,i.jsx)(n.p,{children:"and look for"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Status: Failed\nReason: Evicted\n"})}),"\n",(0,i.jsx)(n.p,{children:"You can also view the eviction event in your cluster monitoring stack (e.g. Datadog)."}),"\n",(0,i.jsxs)(n.p,{children:["Evictions typically happen only when running Feldera in shared Kubernetes\nclusters. The pods to evict are determined by ",(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/",children:"Kubernetes Quality-of-Service\nclasses"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["By default, Feldera Pipelines do not reserve any CPU or memory resources, which\nputs them in the ",(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-qos/#besteffort",children:(0,i.jsx)(n.code,{children:"BestEffort"})})," priority class,\nmaking them eviction candidates. To raise their priority:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-qos/#burstable",children:(0,i.jsx)(n.code,{children:"Burstable"})})," class: reserve a minimum amount of memory and CPU:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"resources": {\n    "cpu_cores_min": 16,\n    "memory_mb_min": 32000,\n}\n'})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://kubernetes.io/docs/concepts/workloads/pods/pod-qos/#guaranteed",children:(0,i.jsx)(n.code,{children:"Guaranteed"})})," class: set minimum and maximum resources to the same value, for memory and CPU:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"resources": {\n    "cpu_cores_min": 16,\n    "cpu_cores_max": 16,\n    "memory_mb_min": 32000,\n    "memory_mb_max": 32000,\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"rust-compilation-errors",children:"Rust Compilation Errors"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Error"}),": ",(0,i.jsx)(n.code,{children:"No space left on device"})," during Rust compilation"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution"}),": Ensure the compiler-server has sufficient disk space (20Gib by default, configured via the ",(0,i.jsx)(n.code,{children:"compilerPvcStorageSize"})," value in the Helm chart)."]}),"\n",(0,i.jsx)(n.h2,{id:"diagnosing-performance-issues",children:"Diagnosing Performance Issues"}),"\n",(0,i.jsx)(n.p,{children:"When investigating pipeline performance, Feldera support will typically request a support-bundle.  The bundle can be downloaded from your installation with the following:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The ",(0,i.jsx)(n.code,{children:"support-bundle"})," ",(0,i.jsx)(n.a,{href:"/interface/cli",children:"fda command"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"fda support-bundle affected-pipeline-name\n"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["the ",(0,i.jsx)(n.code,{children:"support_bundle"})," ",(0,i.jsx)(n.a,{href:"https://docs.feldera.com/python/examples.html#retrieve-a-support-bundle-for-a-pipeline",children:"function in the Python SDK"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["or the ",(0,i.jsx)(n.code,{children:"support_bundle"})," ",(0,i.jsx)(n.a,{href:"https://docs.feldera.com/api/generate-a-support-bundle-for-a-pipeline",children:"endpoint in the REST API"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"The support bundle contains the following content:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Pipeline Logs"}),": for warnings and errors from the ",(0,i.jsx)(n.a,{href:"https://docs.feldera.com/api/retrieve-logs-of-a-pipeline-as-a-stream",children:"logs"})," endpoint."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Pipeline Configuration"}),": the ",(0,i.jsx)(n.a,{href:"https://docs.feldera.com/api/retrieve-a-pipeline",children:"pipeline configuration"}),", including the SQL code and connector settings."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Pipeline Metrics"}),": from the ",(0,i.jsx)(n.a,{href:"https://docs.feldera.com/api/retrieve-circuit-metrics-of-a-running-or-paused-pipeline",children:"pipeline metrics"})," endpoint."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Endpoint Stats"}),": from the ",(0,i.jsx)(n.a,{href:"https://docs.feldera.com/api/retrieve-statistics-e-g-performance-counters-of-a-running-or-paused-pipeline",children:"stats"})," endpoint."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Circuit Profile"}),": from the ",(0,i.jsx)(n.a,{href:"https://docs.feldera.com/api/retrieve-the-circuit-performance-profile-of-a-running-or-paused-pipeline",children:"circuit profile"})," endpoint."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Heap Profile"}),": from ",(0,i.jsx)(n.a,{href:"https://docs.feldera.com/api/retrieve-the-heap-profile-of-a-running-or-paused-pipeline",children:"heap usage"})," endpoint."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);