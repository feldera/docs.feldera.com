"use strict";(self.webpackChunkfeldera_docs=self.webpackChunkfeldera_docs||[]).push([[6304],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>c});var s=t(96540);const i={},o=s.createContext(i);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(o.Provider,{value:n},e.children)}},63374:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"connectors/sinks/kafka","title":"Kafka output connector","description":"Feldera can output a stream of changes to a SQL table or view to a Kafka topic.","source":"@site/docs/connectors/sinks/kafka.md","sourceDirName":"connectors/sinks","slug":"/connectors/sinks/kafka","permalink":"/connectors/sinks/kafka","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Delta Lake","permalink":"/connectors/sinks/delta"},"next":{"title":"Confluent JDBC Connector","permalink":"/connectors/sinks/confluent-jdbc"}}');var i=t(74848),o=t(28453);const a={},c="Kafka output connector",r={},l=[{value:"Example usage",id:"example-usage",level:2},{value:"Authentication &amp; Encryption",id:"authentication--encryption",level:3},{value:"SSL with PEM keys",id:"ssl-with-pem-keys",level:4},{value:"Multiple certificates",id:"multiple-certificates",level:4},{value:"Connecting to AWS MSK with IAM SASL",id:"connecting-to-aws-msk-with-iam-sasl",level:3},{value:"Additional resources",id:"additional-resources",level:2}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"kafka-output-connector",children:"Kafka output connector"})}),"\n",(0,i.jsx)(n.p,{children:"Feldera can output a stream of changes to a SQL table or view to a Kafka topic."}),"\n",(0,i.jsxs)(n.p,{children:["The Kafka output connector supports ",(0,i.jsx)(n.a,{href:"/pipelines/fault-tolerance",children:"fault\ntolerance"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The Kafka connector uses ",(0,i.jsx)(n.strong,{children:"librdkafka"})," in its implementation and\nsupports ",(0,i.jsx)(n.a,{href:"https://github.com/confluentinc/librdkafka/blob/master/CONFIGURATION.md",children:"relevant options for\nconsumers"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"example-usage",children:"Example usage"}),"\n",(0,i.jsxs)(n.p,{children:["We will create a Kafka output connector named ",(0,i.jsx)(n.code,{children:"total-sales"}),".\nKafka broker is located at ",(0,i.jsx)(n.code,{children:"example.com:9092"})," and the topic is ",(0,i.jsx)(n.code,{children:"total-sales"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'CREATE VIEW V\nWITH (\n   \'connectors\' = \'[\n    {\n      "transport": {\n          "name": "kafka_output",\n          "config": {\n              "bootstrap.servers": "example.com:9092",\n              "auto.offset.reset": "earliest",\n              "topic": "total-sales"\n          }\n      },\n      "format": {\n          "name": "json",\n          "config": {\n              "update_format": "insert_delete",\n              "array": false\n          }\n      }\n   }\n   ]\'\n)\nAS ...\n'})}),"\n",(0,i.jsx)(n.h3,{id:"authentication--encryption",children:"Authentication & Encryption"}),"\n",(0,i.jsx)(n.h4,{id:"ssl-with-pem-keys",children:"SSL with PEM keys"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"config": {\n    "bootstrap.servers": "example.com:9092",\n    "auto.offset.reset": "earliest",\n    "topic": "book-fair-sales",\n    "security.protocol": "SSL",\n    "ssl.ca.pem": "-----BEGIN CERTIFICATE-----TOPSECRET0\\n-----END CERTIFICATE-----\\n",\n    "ssl.key.pem": "-----BEGIN CERTIFICATE-----TOPSECRET1\\n-----END CERTIFICATE-----\\n",\n    "ssl.certificate.pem": "-----BEGIN CERTIFICATE-----TOPSECRET2\\n-----END CERTIFICATE-----\\n",\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["PEM-encoded certificates can be passed directly in the configuration using\n",(0,i.jsx)(n.code,{children:"ssl.*.pem"})," keys."]}),"\n",(0,i.jsx)(n.h4,{id:"multiple-certificates",children:"Multiple certificates"}),"\n",(0,i.jsxs)(n.p,{children:["librdkafka only accepts multiple certificates when provided via\n",(0,i.jsx)(n.code,{children:"ssl.certificate.location"})," keys (file paths) rather than directly\nwith ",(0,i.jsx)(n.code,{children:"ssl.certificate.pem"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["This is documented in\n",(0,i.jsx)(n.a,{href:"https://github.com/confluentinc/librdkafka/issues/3225",children:"librdkafka issue #3225"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"To work around this limitation, Feldera handles PEM-encoded certificates and\nkeys by:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Storing the value passed to ",(0,i.jsx)(n.code,{children:"ssl.certificate.pem"})," into a file."]}),"\n",(0,i.jsx)(n.li,{children:"Naming the file using the SHA256 hash of the data."}),"\n",(0,i.jsxs)(n.li,{children:["Replacing the ",(0,i.jsx)(n.code,{children:"ssl.certificate.pem"})," configuration option with\n",(0,i.jsx)(n.code,{children:"ssl.certificate.location"})," option that points to the newly saved file."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Example:"})}),"\n",(0,i.jsx)(n.p,{children:"The updated configuration would look like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'"config": {\n    ...,\n    "ssl.certificate.location": "path/to/certificate.pem"\n}\n'})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["\u26a0\ufe0f"," If both ",(0,i.jsx)(n.code,{children:"ssl.certificate.pem"})," and ",(0,i.jsx)(n.code,{children:"ssl.certificate.location"})," are set\nthe latter will be overwritten."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"connecting-to-aws-msk-with-iam-sasl",children:"Connecting to AWS MSK with IAM SASL"}),"\n",(0,i.jsx)(n.p,{children:"Example of writing data to AWS MSK with IAM SASL."}),"\n",(0,i.jsxs)(n.admonition,{type:"important",children:[(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["AWS credentials must either be set as Environment Variables or present in ",(0,i.jsx)(n.code,{children:"~/.aws/credentials"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Ensure that the defined output topic either exists in AWS MSK or, automatic topic creation is enabled."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"sasl.mechanism"})," must be set to ",(0,i.jsx)(n.code,{children:"OAUTHBEARER"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"security.protocol"})," must be set to ",(0,i.jsx)(n.code,{children:"SASL_SSL"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["When the ",(0,i.jsx)(n.code,{children:"sasl.mechanism"})," is ",(0,i.jsx)(n.code,{children:"OAUTHBEARER"}),", the AWS region for MSK must either be set via the environment\nvariable ",(0,i.jsx)(n.code,{children:"AWS_REGION"})," or the ",(0,i.jsx)(n.code,{children:"region"})," field in connector definition as in the example below."]}),"\n"]}),(0,i.jsx)(n.p,{children:"Other protocols and mechanisms aren't supported."})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sql",children:'\nCREATE VIEW OUTPUT\nWITH (\n   \'connectors\' = \'[\n    {\n      "transport": {\n          "name": "kafka_output",\n          "config": {\n              "bootstrap.servers": "broker-1.kafka.region.amazonaws.com:9098,broker-2.kafka.region.amazonaws.com:9098",\n              "sasl.mechanism": "OAUTHBEARER",\n              "security.protocol": "SASL_SSL",\n              "region": "<AWS_REGION>",\n              "topic": "<TOPIC>"\n          }\n      },\n      "format": {\n          "name": "json",\n          "config": {\n              "update_format": "insert_delete",\n              "array": false\n          }\n      }\n   }\n   ]\'\n) as select * from INPUT;\n'})}),"\n",(0,i.jsx)(n.h2,{id:"additional-resources",children:"Additional resources"}),"\n",(0,i.jsx)(n.p,{children:"For more information, see:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/connectors/sources/kafka#how-to-write-connector-config",children:"Kafka input connector"}),"\nfor examples on how to write the configuration to connect to Kafka brokers (e.g., how to\nspecify authentication and encryption)."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/tutorials/basics/part3#step-2-configure-kafkaredpanda-connectors",children:"Tutorial section"})," which involves\ncreating a Kafka output connector."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Data formats such as ",(0,i.jsx)(n.a,{href:"/formats/json",children:"JSON"})," and\n",(0,i.jsx)(n.a,{href:"/formats/csv",children:"CSV"})]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Overview of Kafka configuration options:\n",(0,i.jsx)(n.a,{href:"https://github.com/confluentinc/librdkafka/blob/master/CONFIGURATION.md",children:"librdkafka options"})]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);