"use strict";(self.webpackChunkfeldera_docs=self.webpackChunkfeldera_docs||[]).push([[1161],{28453:(e,n,t)=>{t.d(n,{R:()=>c,x:()=>a});var i=t(96540);const r={},s=i.createContext(r);function c(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),i.createElement(s.Provider,{value:n},e.children)}},36493:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"get-started/enterprise/https","title":"HTTPS","description":"This document describes how to configure the endpoints of Feldera components (API server, compiler,","source":"@site/docs/get-started/enterprise/https.md","sourceDirName":"get-started/enterprise","slug":"/get-started/enterprise/https","permalink":"/get-started/enterprise/https","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Okta SSO","permalink":"/get-started/enterprise/authentication/okta-sso"},"next":{"title":"Parallel Compilation","permalink":"/get-started/enterprise/parallel-compilation"}}');var r=t(74848),s=t(28453);const c={},a="HTTPS",l={},o=[{value:"Wildcard Certificate Generation",id:"wildcard-certificate-generation",level:2},{value:"Generating a self-signed certificate with OpenSSL",id:"generating-a-self-signed-certificate-with-openssl",level:3},{value:"Using a certificate signed by an external CA",id:"using-a-certificate-signed-by-an-external-ca",level:3},{value:"Private CA Certificate Chain Generation",id:"private-ca-certificate-chain-generation",level:2},{value:"Generating a private CA with OpenSSL",id:"generating-a-private-ca-with-openssl",level:3},{value:"Configure Kubernetes",id:"configure-kubernetes",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"https",children:"HTTPS"})}),"\n",(0,r.jsx)(n.p,{children:"This document describes how to configure the endpoints of Feldera components (API server, compiler,\nrunner, pipelines) to serve HTTPS in the Enterprise edition."}),"\n",(0,r.jsxs)(n.p,{children:["For Feldera to support HTTPS with single-host pipelines, the\nadministrator must configure Feldera with a ",(0,r.jsx)(n.a,{href:"#wildcard-certificate-generation",children:"wildcard\ncertificate"})," and a private key for\nits main DNS domain, e.g. for ",(0,r.jsx)(n.code,{children:"*.feldera.svc.cluster.local"}),".  The\nFeldera API server, compiler runner, pipeline runner, pipeline\nstateful sets, and other top-level components share this certificate\nand key."]}),"\n",(0,r.jsxs)(n.p,{children:["For Feldera to also support HTTPS with multihost pipelines, the\nadministrator must additionally configure Feldera with a ",(0,r.jsx)(n.a,{href:"#private-ca-certificate-chain-generation",children:"private CA\ncertificate chain"})," and\nprivate key.  This allows the Feldera pipeline runner to generate keys\nfor multihost pipeline pods in their nested DNS domains,\ne.g. ",(0,r.jsx)(n.code,{children:"<pipeline>-<ordinal>.<pipeline>.feldera.svc.cluster.local"}),",\nwhich a single wildcard certificate cannot cover.  The generated\ncertificates are only used for connections between Feldera components,\nsuch as between the pipeline pods and the pipeline manager, not\nexternal software."]}),"\n",(0,r.jsx)(n.admonition,{type:"note",children:(0,r.jsxs)(n.p,{children:["Feldera does not support mTLS authentication.  The API server supports\n",(0,r.jsx)(n.a,{href:"/get-started/enterprise/authentication/",children:"API authentication"}),"."]})}),"\n",(0,r.jsxs)(n.p,{children:["This document does not apply to the connection to the Postgres database used by the control plane,\nwhich can be ",(0,r.jsx)(n.a,{href:"/get-started/enterprise/helm-guide",children:"configured separately"}),"."]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"Before switching an existing Feldera installation to using HTTPS, it is required to stop\nall existing running pipelines because otherwise the still running pipelines will continue\nto serve their HTTP endpoint -- which the runner will no longer be able to communicate with\nas it expects HTTPS. Restart the pipelines after configuring HTTPS."})}),"\n",(0,r.jsx)(n.h2,{id:"wildcard-certificate-generation",children:"Wildcard Certificate Generation"}),"\n",(0,r.jsxs)(n.p,{children:["To support HTTPS, the administrator must generate and install a\nwildcard certificate for ",(0,r.jsx)(n.code,{children:"*.<namespace>.svc.cluster.local"}),", where\n",(0,r.jsx)(n.code,{children:"<namespace>"})," is the Kubernetes namespace in use, such as ",(0,r.jsx)(n.code,{children:"feldera"}),"."]}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["When using ",(0,r.jsx)(n.code,{children:"kubectl"})," port forwarding, it is also useful to add\nhostname ",(0,r.jsx)(n.code,{children:"localhost"})," and/or ",(0,r.jsx)(n.code,{children:"127.0.0.1"})," to the certificate."]})}),"\n",(0,r.jsxs)(n.p,{children:["Any method for generating a signed certificate is acceptable.  We\nassume later that the certificate file is named ",(0,r.jsx)(n.code,{children:"tls.crt"})," and the\nprivate key file ",(0,r.jsx)(n.code,{children:"tls.key"}),".  The following sections describe two ways\nto generate these files."]}),"\n",(0,r.jsx)(n.h3,{id:"generating-a-self-signed-certificate-with-openssl",children:"Generating a self-signed certificate with OpenSSL"}),"\n",(0,r.jsxs)(n.p,{children:["Suppose that we install Feldera in namespace ",(0,r.jsx)(n.code,{children:"feldera"})," and will be\nusing ",(0,r.jsx)(n.code,{children:"kubectl"})," port forwarding."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"x509_v3.ext"})," to specify the SANs (Subject Alternative Names):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[x509_v3]\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1 = localhost\nDNS.2 = *.feldera.svc.cluster.local\nIP.1 = 127.0.0.1\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Generate the certificate and private key using ",(0,r.jsx)(n.code,{children:"openssl"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"openssl req -x509 -newkey rsa:4096 -nodes \\\n  -keyout tls.key -out tls.crt -days 365 \\\n  -subj '/CN=localhost' -config x509_v3.ext -extensions x509_v3\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["This will create the ",(0,r.jsx)(n.code,{children:"tls.key"})," and ",(0,r.jsx)(n.code,{children:"tls.crt"})," files."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"using-a-certificate-signed-by-an-external-ca",children:"Using a certificate signed by an external CA"}),"\n",(0,r.jsxs)(n.p,{children:["If the certificate is not self-signed, but instead is signed by a root CA or an intermediate CA,\nthe ",(0,r.jsx)(n.code,{children:"tls.crt"})," should contain the complete bundle of the entire chain up until the root certificate\nauthority. As such, it should contain multiple  ",(0,r.jsx)(n.code,{children:"-----BEGIN CERTIFICATE----- (...) -----END CERTIFICATE-----"}),"\nsections, starting with the leaf certificate and ending with the root certificate. The ",(0,r.jsx)(n.code,{children:"tls.key"}),"\nshould only contain the single private key of the leaf certificate."]}),"\n",(0,r.jsx)(n.h2,{id:"private-ca-certificate-chain-generation",children:"Private CA Certificate Chain Generation"}),"\n",(0,r.jsxs)(n.p,{children:["To support HTTPS for multihost pipelines, the administrator must\nadditionally configure Feldera with a private CA certificate chain and\nprivate key.  This allows the Feldera pipeline runner to generate keys\nfor multihost pipeline pods in their nested DNS domains,\ne.g. ",(0,r.jsx)(n.code,{children:"<pipeline>-<ordinal>.<pipeline>.feldera.svc.cluster.local"}),",\nwhich a single wildcard certificate cannot cover."]}),"\n",(0,r.jsx)(n.p,{children:"The private CA certificate chain can be and should be separate from\nany other PKI, because it is used only for connections between Feldera\ncomponents, such as between the pipeline pods and the pipeline\nmanager, not external software."}),"\n",(0,r.jsxs)(n.p,{children:["Any method for generating a private CA certificate chain is\nacceptable.  We assume later that the CA certificate chain file is\nnamed ",(0,r.jsx)(n.code,{children:"private_ca.crt"})," and the private key file ",(0,r.jsx)(n.code,{children:"private_ca.key"}),".  The\nsection below describes one way to generate these files."]}),"\n",(0,r.jsx)(n.h3,{id:"generating-a-private-ca-with-openssl",children:"Generating a private CA with OpenSSL"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"root_x509_v3.ext"})," to specify options for the root private CA:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[x509_v3]\nbasicConstraints = CA:TRUE,pathlen:1\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Create ",(0,r.jsx)(n.code,{children:"intermediate_x509_v3.ext"})," to specify options for the\nintermediate private CA:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[x509_v3]\nbasicConstraints = CA:TRUE,pathlen:0\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Generate the root CA with ",(0,r.jsx)(n.code,{children:"openssl"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"openssl req -x509 -newkey rsa:4096 -nodes \\\n      -keyout private_root_tls.key -out private_root_tls.crt -days 365 \\\n      -subj '/CN=FelderaTest Private Root CA' \\\n      -config root_x509_v3.ext -extensions x509_v3\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Generate and sign the intermediate CA with ",(0,r.jsx)(n.code,{children:"openssl"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"openssl req -new -newkey rsa:4096 -nodes \\\n    -keyout private_intermediate_tls.key -out private_intermediate_tls.csr \\\n    -subj '/CN=FelderaTest Intermediate CA'\nopenssl x509 -req \\\n    -in private_intermediate_tls.csr -CA private_root_tls.crt -CAkey private_root_tls.key \\\n    -CAcreateserial -out private_intermediate_tls.crt \\\n    -days 360 -sha256 \\\n    -extfile intermediate_x509_v3.ext -extensions x509_v3\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Produce the secret to install into Kubernetes:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"cat private_intermediate_tls.crt private_root_tls.crt > private_ca.crt\ncat private_intermediate_tls.key > private_ca.key\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"configure-kubernetes",children:"Configure Kubernetes"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Create the Kubernetes TLS secret for ",(0,r.jsx)(n.code,{children:"tls.key"})," and ",(0,r.jsx)(n.code,{children:"tls.crt"})," files\nfrom ",(0,r.jsx)(n.a,{href:"#wildcard-certificate-generation",children:"wildcard certificate\ngeneration"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl create -n <namespace> secret tls feldera-https-config --key tls.key --cert tls.crt\n"})}),"\n",(0,r.jsx)(n.p,{children:"The secret (i.e., certificate and key) will be mounted as a directory with corresponding files\nby each of the Feldera component (API server, compiler, runner, pipelines) pods."}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["To additionally support multihost pipelines, create a Kubernetes\nTLS secret for ",(0,r.jsx)(n.code,{children:"private_ca.key"})," and ",(0,r.jsx)(n.code,{children:"private_ca.crt"})," from ",(0,r.jsx)(n.a,{href:"#private-ca-certificate-chain-generation",children:"private\nCA certificate chain\ngeneration"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl create -n <namespace> secret tls feldera-ca-config --key private_ca.key --cert private_ca.crt\n"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Provide in the Helm installation the reference for the\n",(0,r.jsx)(n.code,{children:"httpsSecretRef"})," and, for multihost support, ",(0,r.jsx)(n.code,{children:"caSecretRef"}),", value."]}),"\n",(0,r.jsx)(n.p,{children:"If you did not create the private CA for multihost pipeline support:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Via file ",(0,r.jsx)(n.code,{children:"values.yaml"}),":"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'httpsSecretRef: "feldera-https-config"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"In the command:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'helm upgrade --install feldera \\\n  ... \\\n  --set httpsSecretRef="feldera-https-config"\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"If you did create the private CA for multihost pipeline support:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsxs)(n.strong,{children:["Via file ",(0,r.jsx)(n.code,{children:"values.yaml"}),":"]})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'httpsSecretRef: "feldera-https-config"\ncaSecretRef: "feldera-ca-config"\n'})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"In the command:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'helm upgrade --install feldera \\\n  ... \\\n  --set httpsSecretRef="feldera-https-config" \\\n  --set caSecretRef="feldera-ca-config"\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"(Optional) Port forward:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"kubectl port-forward -n feldera svc/feldera-api-server 8080:8080\n"})}),"\n",(0,r.jsxs)(n.p,{children:["... and then open in the browser: ",(0,r.jsx)(n.a,{href:"https://localhost:8080",children:"https://localhost:8080"})]}),"\n",(0,r.jsx)(n.p,{children:"Note that the certificate will need to be trusted to not encounter\nerrors about an insecure connection (or self-signed certificates).\nFor example, when using curl:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"curl --cacert tls.crt https://localhost:8080/v0/pipelines\n"})}),"\n",(0,r.jsxs)(n.p,{children:['It is no longer possible to reach the endpoints via HTTP.\nAttempting to do so will result in a failure to parse the HTTPS response;\nthis will for example elicit error messages such as\n"localhost sent an invalid response" (Chrome) or\n"Received HTTP/0.9 when not allowed" (curl).\nUse ',(0,r.jsx)(n.code,{children:"https://"})," as the protocol."]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);