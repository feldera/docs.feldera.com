"use strict";(self.webpackChunkfeldera_docs=self.webpackChunkfeldera_docs||[]).push([[8077],{8213:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/feldera-data-source-4b7c14c96b1c0d58a95616a78833336a.png"},28453:(e,n,a)=>{a.d(n,{R:()=>i,x:()=>l});var s=a(96540);const t={},r=s.createContext(t);function i(e){const n=s.useContext(r);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:i(e.components),s.createElement(r.Provider,{value:n},e.children)}},66858:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>l,default:()=>h,frontMatter:()=>i,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"use_cases/otel/grafana","title":"Grafana Integration","description":"The next step is to integrate with Grafana so that we can query Feldera for these insights.","source":"@site/docs/use_cases/otel/grafana.md","sourceDirName":"use_cases/otel","slug":"/use_cases/otel/grafana","permalink":"/use_cases/otel/grafana","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Extracting High-Level Metrics","permalink":"/use_cases/otel/insights"},"next":{"title":"Using the REST API","permalink":"/tutorials/rest_api/"}}');var t=a(74848),r=a(28453);const i={},l="Grafana Integration",o={},d=[{value:"Step 1: Install the Feldera Grafana Plugin",id:"step-1-install-the-feldera-grafana-plugin",level:4},{value:"Step 2: Add Feldera as a Data Source in Grafana",id:"step-2-add-feldera-as-a-data-source-in-grafana",level:4},{value:"Step 3: Configure the Feldera Data Source",id:"step-3-configure-the-feldera-data-source",level:4},{value:"Required Fields:",id:"required-fields",level:5},{value:"Creating a Grafana Dashboard",id:"creating-a-grafana-dashboard",level:2},{value:"Requests Count",id:"requests-count",level:4},{value:"Slowest Traces",id:"slowest-traces",level:4},{value:"Histogram of Latencies",id:"histogram-of-latencies",level:4},{value:"P95 Latencies",id:"p95-latencies",level:4},{value:"Throughput",id:"throughput",level:4},{value:"Pie chart of Operation Executions Time",id:"pie-chart-of-operation-executions-time",level:4},{value:"Takeaways",id:"takeaways",level:2}];function c(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h4:"h4",h5:"h5",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",section:"section",strong:"strong",sup:"sup",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"grafana-integration",children:"Grafana Integration"})}),"\n",(0,t.jsx)(n.p,{children:"The next step is to integrate with Grafana so that we can query Feldera for these insights."}),"\n",(0,t.jsxs)(n.p,{children:["We will create a Grafana dashboard",(0,t.jsx)(n.sup,{children:(0,t.jsx)(n.a,{href:"#user-content-fn-1",id:"user-content-fnref-1","data-footnote-ref":!0,"aria-describedby":"footnote-label",children:"1"})})," like the one shown below:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Grafana Dashboard",src:a(68352).A+"",width:"3440",height:"1440"})}),"\n",(0,t.jsx)(n.h4,{id:"step-1-install-the-feldera-grafana-plugin",children:"Step 1: Install the Feldera Grafana Plugin"}),"\n",(0,t.jsxs)(n.p,{children:["Since the Feldera data source plugin is not yet available in the Grafana marketplace, it must be ",(0,t.jsx)(n.strong,{children:"manually installed"})," from ",(0,t.jsx)(n.a,{href:"https://github.com/feldera/grafana-datasource",children:"GitHub"}),". You can download the latest release and unzip in in the plugins directory of your Grafana server."]}),"\n",(0,t.jsxs)(n.p,{children:["This plugin allows Grafana to seamlessly execute ad-hoc queries (see: ",(0,t.jsx)(n.a,{href:"https://docs.feldera.com/sql/ad-hoc",children:"Ad-hoc Query docs"}),") on Feldera pipelines, to treat Feldera just like any other compatible data source."]}),"\n",(0,t.jsx)(n.h4,{id:"step-2-add-feldera-as-a-data-source-in-grafana",children:"Step 2: Add Feldera as a Data Source in Grafana"}),"\n",(0,t.jsxs)(n.p,{children:["Steps to add a new data source:\n7. Open the Grafana Dashboard and go to ",(0,t.jsx)(n.strong,{children:"Connections -> Add New Connection"}),"\n8. Search for ",(0,t.jsx)(n.strong,{children:"Feldera"})," and select the ",(0,t.jsx)(n.strong,{children:"Feldera Data Source Plugin"}),".\n9. Click ",(0,t.jsx)(n.strong,{children:'"Add a new data source"'}),"."]}),"\n",(0,t.jsx)(n.h4,{id:"step-3-configure-the-feldera-data-source",children:"Step 3: Configure the Feldera Data Source"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Feldera Data Source Config",src:a(8213).A+"",width:"700",height:"446"})}),"\n",(0,t.jsx)(n.h5,{id:"required-fields",children:"Required Fields:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Field"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Base URL"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"http://feldera:8080"})," ",(0,t.jsx)(n.em,{children:"(If running in Docker alongside Grafana)"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Pipeline Name"}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"otel"})," ",(0,t.jsx)(n.em,{children:"(Your Feldera pipeline name)"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"API Key"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.em,{children:"(If authentication is required, provide the API Key)"})})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["Click ",(0,t.jsx)(n.strong,{children:'"Save & Test"'})," to verify the connection."]}),"\n",(0,t.jsx)(n.h2,{id:"creating-a-grafana-dashboard",children:"Creating a Grafana Dashboard"}),"\n",(0,t.jsxs)(n.p,{children:["Once Feldera is set up as a data source, you can build a ",(0,t.jsx)(n.strong,{children:"custom Grafana dashboard"})," to visualize OpenTelemetry data."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["For all the visualizations we create here, use the ",(0,t.jsx)(n.strong,{children:"feldera"})," data source."]}),"\n",(0,t.jsxs)(n.li,{children:["For all ",(0,t.jsx)(n.strong,{children:"time series visualizations"}),", it is important to define a ",(0,t.jsx)(n.strong,{children:"data type transformation"})," to specify the ",(0,t.jsx)(n.code,{children:"TIME"})," field of the data."]}),"\n",(0,t.jsxs)(n.li,{children:["All of the queries defined below are run by Grafana using the ",(0,t.jsx)(n.strong,{children:"feldera"})," data source plugin to query our OTel pipeline."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"requests-count",children:"Requests Count"}),"\n",(0,t.jsxs)(n.p,{children:["This visualization displays the total number of requests in the selected time range.\nVisualization Type: ",(0,t.jsx)(n.strong,{children:"Stat"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- requests count\nSELECT\n\tCOUNT(*) as num_traces\nFROM\n\tspans s\nWHERE\n\ts.parentSpanId = '' AND\n\ts.eventTime BETWEEN $__timeFrom() AND $__timeTo()\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Filters only ",(0,t.jsx)(n.strong,{children:"top-level spans"})," (i.e., spans without a ",(0,t.jsx)(n.code,{children:"parentSpanId"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:["Uses Grafana's ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"$__timeFrom()"})})," and ",(0,t.jsx)(n.strong,{children:(0,t.jsx)(n.code,{children:"$__timeTo()"})})," macros to dynamically apply the selected time range."]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"slowest-traces",children:"Slowest Traces"}),"\n",(0,t.jsxs)(n.p,{children:["Identifies the six slowest traces in the given time frame.\nVisualization Type: ",(0,t.jsx)(n.strong,{children:"Table"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- slowest traces\nSELECT\n\ts.traceId, s.name, s.elapsedTimeMillis\nFROM\n\tspans s\nWHERE\n\ts.parentSpanId = '' AND\n\ts.eventTime BETWEEN $__timeFrom() AND $__timeTo()\nORDER BY\n\telapsedTimeMillis DESC\nLIMIT\n\t6\n"})}),"\n",(0,t.jsx)(n.h4,{id:"histogram-of-latencies",children:"Histogram of Latencies"}),"\n",(0,t.jsxs)(n.p,{children:["Provides a latency histogram to analyze response time patterns.\nVisualization Type: ",(0,t.jsx)(n.strong,{children:"Histogram"})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- histogram of latencies\nSELECT\n\ts.elapsedTimeMillis\nFROM\n\tspans s\nWHERE\n\ts.parentSpanId = '' AND\n\ts.eventTime BETWEEN $__timeFrom() AND $__timeTo()\nORDER BY\n\ts.eventTime DESC\n"})}),"\n",(0,t.jsx)(n.h4,{id:"p95-latencies",children:"P95 Latencies"}),"\n",(0,t.jsxs)(n.p,{children:["Tracks the ",(0,t.jsx)(n.strong,{children:"95th percentile latency"})," over time.\nVisualization Type: ",(0,t.jsx)(n.strong,{children:'"Bar chart"'})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- p95_latency\nSELECT\n\t*\nFROM\n\tp95_latency\nWHERE\n\ttime BETWEEN $__timeFrom() AND $__timeTo()\nORDER BY\n\ttime DESC\n"})}),"\n",(0,t.jsx)(n.h4,{id:"throughput",children:"Throughput"}),"\n",(0,t.jsxs)(n.p,{children:["Measures the ",(0,t.jsx)(n.strong,{children:"number of requests per 10 second buckets"}),".\nVisualization Type: ",(0,t.jsx)(n.strong,{children:'"Bar chart"'})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- throughput\nSELECT\n\t*\nFROM\n\tthroughput\nWHERE\n\ttime BETWEEN $__timeFrom() AND $__timeTo()\nORDER BY\n\ttime DESC\n"})}),"\n",(0,t.jsx)(n.h4,{id:"pie-chart-of-operation-executions-time",children:"Pie chart of Operation Executions Time"}),"\n",(0,t.jsxs)(n.p,{children:["Displays ",(0,t.jsx)(n.strong,{children:"execution time per operation"}),", showing where time is spent.\nVisualization Type: ",(0,t.jsx)(n.strong,{children:'"Pie chart"'})]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- operation executions time\nSELECT\n\tsum(elapsed) as elapsed,\n\tname\nFROM\n\toperation_execution_time\nGROUP BY\n\tname\n"})}),"\n",(0,t.jsx)(n.h2,{id:"takeaways",children:"Takeaways"}),"\n",(0,t.jsxs)(n.p,{children:["In this example, we used Feldera to analyze OpenTelemetry data and visualize it in Grafana.\nWe demonstrated how OTel data can be easily modeled in Feldera using ",(0,t.jsx)(n.code,{children:"VARIANT"})," and custom types,\nand how aggregations and window functions can be used for powerful analysis."]}),"\n",(0,t.jsx)(n.p,{children:"Additionally, we show how seamlessly, using the Feldera data source plugin, Grafana can query Feldera using\nad-hoc SQL queries to create insightful dashboards."}),"\n",(0,t.jsx)(n.p,{children:"Feldera also enables users to join traces, metrics, and logs, providing a more comprehensive view of the\nsystem being observed."}),"\n",(0,t.jsxs)(n.p,{children:["Moreover, further optimizations can be applied to this example using constructs like\n",(0,t.jsx)(n.a,{href:"https://docs.feldera.com/sql/streaming#lateness-expressions",children:"LATENESS"}),"\nand ",(0,t.jsx)(n.a,{href:"https://www.feldera.com/blog/storage-shipped",children:"Storage"}),"\nto efficiently garbage collect old state, and manage resource usage."]}),"\n","\n",(0,t.jsxs)(n.section,{"data-footnotes":!0,className:"footnotes",children:[(0,t.jsx)(n.h2,{className:"sr-only",id:"footnote-label",children:"Footnotes"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{id:"user-content-fn-1",children:["\n",(0,t.jsxs)(n.p,{children:["This dashboard takes inspiration from the workshop: ",(0,t.jsx)(n.a,{href:"https://www.youtube.com/watch?v=rjJgZ_MNmPQ",children:"Analyzing and Visualizing OpenTelemetry Traces with SQL - John Pruitt, Timescale"})," ",(0,t.jsx)(n.a,{href:"#user-content-fnref-1","data-footnote-backref":"","aria-label":"Back to reference 1",className:"data-footnote-backref",children:"\u21a9"})]}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},68352:(e,n,a)=>{a.d(n,{A:()=>s});const s=a.p+"assets/images/grafana-dashboard-f17f8c858afe6d5f4fe2905ada740a08.png"}}]);